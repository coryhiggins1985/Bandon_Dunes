<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bandon Dunes Golf Trip Summary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            background-color: #fff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card {
            background-color: #fff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .table-auto {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem; /* Standard font size for table content */
        }
        .table-auto th, .table-auto td {
            padding: 0.75rem;
            border-bottom: 1px solid #e2e8f0;
            text-align: left;
        }
        .table-auto th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #4a5568;
            text-transform: uppercase;
            font-size: 0.875rem; /* Standard font size for all headers */
        }
        /* Removed specific smaller font size for tee-time-pairings-container th */
        .table-auto tr:last-child td {
            border-bottom: none;
        }
        .table-auto tbody tr:hover {
            background-color: #f0f4f8;
        }
        h1 {
            font-size: 2.25rem; /* text-4xl */
            margin-bottom: 1.5rem;
        }
        h2 {
            font-size: 1.5rem; /* text-2xl */
            margin-bottom: 1rem;
        }
        h3 {
            font-size: 1.25rem; /* text-xl */
            margin-bottom: 1rem;
        }
        /* Ensure tables stack vertically on small screens and side-by-side on md and larger */
        .flex-col.md\:flex-row {
            flex-direction: column; /* Default to column for small screens */
        }
        @media (min-width: 768px) { /* md breakpoint */
            .flex-col.md\:flex-row {
                flex-direction: row; /* Change to row for medium and larger screens */
            }
            .flex-1.md\:w-1\/2 {
                width: 50%; /* Each takes half width on medium and larger screens */
            }
        }
        /* Style for the handicap row */
        .player-handicap-row td {
            background-color: #e0f2fe; /* Light blue shading */
        }
        /* Highlight selected player in daily pairings */
        .highlight-player {
            background-color: #fef08a; /* Tailwind yellow-200 */
            padding: 0 0.25rem;
            border-radius: 0.25rem;
        }
        /* Spacing row style */
        .spacing-row td {
            height: 1rem; /* Adjust height as needed for spacing */
            border-bottom: none; /* Remove border for spacing row */
        }
        /* Style for the last tee time of the day */
        .last-tee-time-of-day td {
            border-bottom: 2px solid #a0a0a0; /* Bold gray line */
        }
        /* Tab styles */
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-bottom: 2px solid transparent;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .tab-button.active {
            border-color: #10b981; /* Tailwind green-500 */
            color: #10b981;
        }
        .tab-button:hover {
            color: #059669; /* Darker green on hover */
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .caddy-player-highlight {
            background-color: #d1fae5; /* Light green for caddy highlight */
        }
        .team-header {
            background-color: #6ee7b7; /* Tailwind green-300 */
            font-size: 1.125rem;
            font-weight: 700;
        }
        .caddy-summary-separator {
            border-bottom: 2px solid #a0a0a0;
        }
        /* New class for the winning team highlight */
        .winning-team-highlight {
            background-color: #86efac; /* Tailwind green-300 */
            font-weight: bold;
        }
    </style>
</head>
<body class="p-4 bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="container bg-white rounded-xl shadow-lg p-6 md:p-8 lg:p-10">
        <!-- Consolidated and Left-Aligned Title without Golf Club Logo -->
        <h1 class="text-3xl md:text-4xl font-bold text-green-800 mb-8 text-left" id="main-trip-summary-title">Bandon Dunes Golf Trip Summary</h1>

        <!-- Tabs Navigation -->
        <div class="flex border-b border-gray-200 mb-6">
            <button id="tab-summary" class="tab-button active">Trip Summary</button>
            <button id="tab-caddy" class="tab-button">Caddy Summary</button>
            <button id="tab-caddy-by-tee-time" class="tab-button">Caddy Summary by Tee Time</button>
        </div>

        <!-- Tab Content: Trip Summary -->
        <div id="content-summary" class="tab-content active">
            <!-- Player Selection -->
            <div class="card mb-6">
                <div class="mb-4 player-select-section w-full md:w-1/2">
                    <label for="player-select" class="block text-lg font-medium text-red-600 mb-2">Select Player:</label>
                    <select id="player-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
            </div>

            <div class="flex flex-col md:flex-row gap-6 mb-6">
                <!-- Stableford Points System -->
                <div class="card flex-1 md:w-1\/2">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Stableford Points System</h2>
                    <table class="table-auto" id="stableford-table">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Score Relative to Par</th>
                                <th class="px-4 py-2">Points</th>
                                <th class="px-4 py-2">Score Relative to Par</th>
                                <th class="px-4 py-2">Points</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border px-4 py-2">Double Eagle (Par 4 or 5)</td>
                                <td class="border px-4 py-2">20</td>
                                <td class="border px-4 py-2">Par</td>
                                <td class="border px-4 py-2">3</td>
                            </tr>
                            <tr>
                                <td class="border px-4 py-2">Hole-in-One</td>
                                <td class="border px-4 py-2">15</td>
                                <td class="border px-4 py-2">Bogey</td>
                                <td class="border px-4 py-2">2</td>
                            </tr>
                            <tr>
                                <td class="border px-4 py-2">Eagle</td>
                                <td class="border px-4 py-2">10</td>
                                <td class="border px-4 py-2">Double Bogey</td>
                                <td class="border px-4 py-2">1</td>
                            </tr>
                            <tr>
                                <td class="border px-4 py-2">Birdie</td>
                                <td class="border px-4 py-2">5</td>
                                <td class="border px-4 py-2">DNF/Triple +</td>
                                <td class="px-4 py-2">0</td>
                            </tr>
                            <!-- Spacing row will be added here by JavaScript -->
                            <!-- Player Handicap row will be added here by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Notes Table -->
                <div class="card flex-1 md:w-1/2">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Notes</h2>
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Note</th>
                            </tr>
                        </thead>
                        <tbody id="notes-table-body">
                            <!-- Notes will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Daily Group Gambling Table -->
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Daily Group Gambling</h2>
                <table class="table-auto">
                    <thead>
                        <tr>
                            <th class="px-4 py-2">Item</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="border px-4 py-2">$50 / daily group bet for AM rounds only, afternoon rounds choose your own adventure.</td>
                        </tr>
                        <tr>
                            <td class="border px-4 py-2">There will be six (6), four (4) man teams. $240 payout per person on the winning team ($960 pot divided by 4).</td>
                        </tr>
                        <tr>
                            <td class="border px-4 py-2">Gimmies are okay but don't swipe a 5 foot putt and call it yourself, let the group decide.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Tee Time Pairings -->
            <div class="card">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Tee Time Pairings</h2>
                <div id="tee-time-pairings-container" class="overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4" id="current-player-tee-times-title"></h3>
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Date</th>
                                <th class="px-4 py-2">Time</th>
                                <th class="px-4 py-2">Estimated Completion Time</th>
                                <th class="px-4 py-2">Course</th>
                                <th class="px-4 py-2">Caddie</th>
                                <th class="px-4 py-2">Playing Partners (Handicap)</th>
                            </tr>
                        </thead>
                        <tbody id="tee-time-pairings-body">
                            </tbody>
                    </table>
                </div>
            </div>

            <!-- Daily Pairings List -->
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Daily Pairings</h2>
                <div id="daily-pairings-container" class="overflow-x-auto">
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Date</th>
                                <th class="px-4 py-2">Time</th>
                                <th class="px-4 py-2">Estimated Completion Time</th>
                                <th class="px-4 py-2">Course</th>
                                <th class="px-4 py-2">All Players (Handicap)</th>
                            </tr>
                        </thead>
                        <tbody id="daily-pairings-body">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab Content: Caddy Summary -->
        <div id="content-caddy" class="tab-content">
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Caddy Summary by Player and Round</h2>
                <div id="caddy-summary-container" class="overflow-x-auto">
                    <table class="table-auto">
                        <thead>
                            <tr id="caddy-summary-header-row">
                                <th class="px-4 py-2">Player</th>
                                <!-- Dynamic date/round headers will go here -->
                            </tr>
                        </thead>
                        <tbody id="caddy-summary-body">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- New Tab Content: Caddy Summary by Tee Time -->
        <div id="content-caddy-by-tee-time" class="tab-content">
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Caddy Summary by Tee Time</h2>
                <div id="caddy-tee-time-summary-container" class="overflow-x-auto">
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Date</th>
                                <th class="px-4 py-2">Time</th>
                                <th class="px-4 py-2">Course</th>
                                <th class="px-4 py-2">Players & Caddies</th>
                                <th class="px-4 py-2">Caddy Summary</th>
                            </tr>
                        </thead>
                        <tbody id="caddy-tee-time-summary-body">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


        <!-- Tabs for Scoring (Empty to start fresh) -->
        <div id="content-scoring-8-20" class="tab-content">
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Daily Scoring (8/20)</h2>
                <div id="scoring-container-8-20" class="overflow-x-auto">
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Team</th>
                                <th class="px-4 py-2">Player</th>
                                <th class="px-4 py-2">Handicap</th>
                                <th class="px-4 py-2">8/20 Score</th>
                                <th class="px-4 py-2">Team Total</th>
                            </tr>
                        </thead>
                        <tbody id="scoring-body-8-20">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="content-scoring-8-21" class="tab-content">
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Daily Scoring (8/21)</h2>
                <div id="scoring-container-8-21" class="overflow-x-auto">
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Team</th>
                                <th class="px-4 py-2">Player</th>
                                <th class="px-4 py-2">Handicap</th>
                                <th class="px-4 py-2">8/21 Score</th>
                                <th class="px-4 py-2">Team Total</th>
                            </tr>
                        </thead>
                        <tbody id="scoring-body-8-21">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="content-scoring-8-22" class="tab-content">
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Daily Scoring (8/22)</h2>
                <div id="scoring-container-8-22" class="overflow-x-auto">
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Team</th>
                                <th class="px-4 py-2">Player</th>
                                <th class="px-4 py-2">Handicap</th>
                                <th class="px-4 py-2">8/22 Score</th>
                                <th class="px-4 py-2">Team Total</th>
                            </tr>
                        </thead>
                        <tbody id="scoring-body-8-22">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="content-scoring-8-23" class="tab-content">
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Daily Scoring (8/23)</h2>
                <div id="scoring-container-8-23" class="overflow-x-auto">
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Team</th>
                                <th class="px-4 py-2">Player</th>
                                <th class="px-4 py-2">Handicap</th>
                                <th class="px-4 py-2">8/23 Score</th>
                                <th class="px-4 py-2">Team Total</th>
                            </tr>
                        </thead>
                        <tbody id="scoring-body-8-23">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="content-scoring-8-24" class="tab-content">
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Daily Scoring (8/24)</h2>
                <div id="scoring-container-8-24" class="overflow-x-auto">
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Team</th>
                                <th class="px-4 py-2">Player</th>
                                <th class="px-4 py-2">Handicap</th>
                                <th class="px-4 py-2">8/24 Score</th>
                                <th class="px-4 py-2">Team Total</th>
                            </tr>
                        </thead>
                        <tbody id="scoring-body-8-24">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Raw CSV data for golf pairings
        const csvData = `Date,Time,Course,Player1,Player2,Player3,Player4,Caddie?,Notes,Start time adjusted,Complete Estimate,Time adjustment,Course,Estimated play time,Col1,Col2,Col3,Col4,Col5,Col6,Col7,Col8,Col9
2025-08-20,3:15 p.m. ,Shorty's,TBD,TBD,TBD,TBD,,Bill to individuals,,2025-08-20 15:15:00,2025-08-20 17:15:00,,855,,Shorty's,2,,,,,,780,220
2025-08-20,2:40 p.m. ,Bandon Dunes,Cory Higgins,Kevin Newell,Mike Newell,Rob Small,YES,2 Caddies,,2025-08-20 14:40:00,2025-08-20 19:10:00,,880,,Bandon Dunes,4.5,,,,,,790,230
2025-08-20,2:50 p.m. ,Bandon Dunes,Zach Deines,Johnathn Resetar,Ryan Hohn,Jacob Emert,,,,2025-08-20 14:50:00,2025-08-20 19:20:00,,890,,Pacific Dunes,4.5,,,,,,800,240
2025-08-20,3:00 p.m.,Bandon Dunes,Bryan Wolfe,Matt Akers,Paul Parker,Andrew Akers,,,,2025-08-20 15:00:00,2025-08-20 19:30:00,,900,,Bandon Preserve,2,,,,,,810,250
2025-08-20,3:10 p.m. ,Bandon Dunes,Kevan Oyama,Bob Owlett,Nick Zangardi,James Adolfson,,,,2025-08-20 15:10:00,2025-08-20 19:40:00,,910,,Bandon Trails,4.5,,,,,,820,260
2025-08-20,3:20 p.m. ,Bandon Dunes,Vikas Bhasin,Daniel Passino,Charlie Hildebrand,Hisham Sayeedi,,,,2025-08-20 15:20:00,2025-08-20 19:50:00,,920,,Old Macdonald,4.5,,,,,,830,270
2025-08-20,6:45 p.m. ,Shorty's,Brandon Itaoka,Cory Micheel,AD Hoffman,Will Quarles,,Bill to individuals,,2025-08-20 18:45:00,2025-08-20 20:45:00,,1125,,Sheep Ranch,4.5,,,,,,840,280
2025-08-21,7:30 a.m. ,Pacific Dunes,Vikas Bhasin,Charlie Hildebrand,Hisham Sayeedi,Daniel Passino,,,,2025-08-21 07:30:00,2025-08-21 12:00:00,,450,,,,,,,,,850,290
2025-08-21,7:40 a.m. ,Pacific Dunes,Cory Higgins,Matt Akers,Andrew Akers,James Adolfson,,,,2025-08-21 07:40:00,2025-08-21 12:10:00,,460,,,,,,,,,860,300
2025-08-21,7:50 a.m. ,Pacific Dunes,Bob Owlett,Kevin Newell,Mike Newell,Rob Small,,,,2025-08-21 07:50:00,2025-08-21 12:20:00,,470,,,,,,,,,870,310
2025-08-21,8:00 a.m. ,Pacific Dunes,Kevan Oyama,Zach Deines,Nick Zangardi,Johnathn Resetar,,,,2025-08-21 08:00:00,2025-08-21 12:30:00,,480,,,,,,,,,880,320
2025-08-21,8:10 a.m. ,Pacific Dunes,Brandon Itaoka,Ryan Hohn,Paul Parker,Jacob Emert,,,,2025-08-21 08:10:00,2025-08-21 12:40:00,,490,,,,,,,,,890,330
2025-08-21,8:20 a.m. ,Pacific Dunes,AD Hoffman,Bryan Wolfe,Will Quarles,Cory Micheel,,,,2025-08-21 08:20:00,2025-08-21 12:50:00,,500,,,,,,,,,900,340
2025-08-21,1:10 p.m. ,Bandon Dunes,Charlie Hildebrand,Hisham Sayeedi,Daniel Passino,Vikas Bhasin,,REPLAY,,2025-08-21 13:10:00,2025-08-21 17:40:00,,790,,,,,,,,,910,350
2025-08-21,1:20 p.m. ,Bandon Dunes,Kevan Oyama,Cory Higgins,Jacob Emert,Mike Newell,,,,2025-08-21 13:20:00,2025-08-21 17:50:00,,800,,Time until next tee time,,,,,,,920,360
2025-08-21,1:30 p.m. ,Bandon Dunes,Zach Deines,Paul Parker,Johnathn Resetar,James Adolfson,,,,2025-08-21 13:30:00,2025-08-21 18:00:00,,810,,Name Not Found in Morning Group,Name Not Found in Morning Group,Name Not Found in Morning Group,Name Not Found in Morning Group,,,,930,370
2025-08-21,1:40 p.m. ,Bandon Dunes,Cory Micheel,Bob Owlett,Will Quarles,AD Hoffman,,,,2025-08-21 13:40:00,2025-08-21 18:10:00,,820,,1080,1264.9999999953434,1069.9999999988358,1090.0000000011642,,,,940,380
2025-08-21,1:50 p.m. ,Bandon Dunes,Ryan Hohn,Nick Zangardi,Bryan Wolfe,,,,,2025-08-21 13:50:00,2025-08-21 18:20:00,,830,,1090.0000000011642,1080,1090.0000000011642,1274.9999999965075,,,,950,390
2025-08-21,1:50 p.m. ,Shorty's,TBD,TBD,,,,,,2025-08-21 13:50:00,2025-08-21 15:50:00,,830,,Shorty's,2,,,,,,955,395
2025-08-21,2:15 p.m. ,Bandon Preserve,Matt Akers,Andrew Akers,Kevin Newell,Rob Small,Brandon Itaoka,Bill to individuals,,2025-02-21 14:15:00,2025-08-21 16:15:00,,855,,1080,1110.0000000034925,1080,1080,,,,960,400
2025-08-21,6:00 p.m.,Bandon Preserve,TBD,TBD,TBD,,,Bill to individuals,,2025-08-21 18:00:00,2025-08-21 20:00:00,,1080,,1100.0000000023283,1110.0000000034925,1090.0000000011642,Name Not Found in Morning Group,,,,970,410
2025-08-22,7:30 a.m. ,Bandon Trails,AD Hoffman,Bryan Wolfe,Bob Owlett,Cory Micheel,,,,2025-08-22 07:30:00,2025-08-22 12:00:00,,450,,1319.9999999965075,1319.9999999965075,1145.0000000023283,1145.0000000023283,,,,980,420
2025-08-22,7:40 a.m. ,Bandon Trails,Cory Higgins,Brandon Itaoka,Ryan Hohn,Paul Parker,,,,2025-08-22 07:40:00,2025-08-22 12:10:00,,460,,Name Not Found in Morning Group,Name Not Found in Morning Group,Name Not Found in Morning Group,Name Not Found in Morning Group,,,,990,430
2025-08-22,7:50 a.m. ,Bandon Trails,Mike Newell,Nick Zangardi,Kevin Newell,Rob Small,,,,2025-08-22 07:50:00,2025-08-22 12:20:00,,470,,,,,,,,,1000,440
2025-08-22,8:00 a.m. ,Bandon Trails,Zach Deines,Johnathn Resetar,James Adolfson,,,,2025-08-22 08:00:00,2025-08-22 12:30:00,,480,,,,,,,,,1010,450
2025-08-22,8:10 a.m. ,Bandon Trails,Vikas Bhasin,Daniel Passino,Hisham Sayeedi,Daniel Passino,,,,2025-08-22 08:10:00,2025-08-22 12:40:00,,490,,,,,,,,,1020,460
2025-08-22,8:20 a.m. ,Bandon Trails,Kevan Oyama,Matt Akers,Andrew Akers,Will Quarles,,,,2025-08-22 08:20:00,2025-08-22 12:50:00,,500,,,,,,,,,1030,470
2025-08-22,1:10 p.m. ,Pacific Dunes,Cory Higgins,Vikas Bhasin,Cory Micheel,Mike Newell,,REPLAY,,2025-08-22 13:10:00,2025-08-22 17:40:00,,790,,,,,,,,,1040,480
2025-08-22,1:20 p.m. ,Pacific Dunes,Bob Owlett,Nick Zangardi,Jacob Emert,Zach Deines,,,,2025-08-22 13:20:00,2025-08-22 17:50:00,,800,,,,,,,,,1050,490
2025-08-22,1:30 p.m. ,Pacific Dunes,James Adolfson,AD Hoffman,Bryan Wolfe,Will Quarles,,,,2025-08-22 13:30:00,2025-08-22 18:00:00,,810,,,,,,,,,1060,500
2025-08-22,1:40 p.m. ,Pacific Dunes,Kevan Oyama,Johnathn Resetar,,,,,,2025-08-22 13:40:00,2025-08-22 18:10:00,,820,,,,,,,,,1070,510
2025-08-22,2:15 p.m. ,Shorty's,Brandon Itaoka,Ryan Hohn,Paul Parker,Charlie Hildebrand,Hisham Sayeedi,Bill to individuals,,2025-08-22 14:15:00,2025-08-22 16:15:00,,855,,,,,,,,,1080,520
2025-08-22,6:30 p.m. ,Shorty's,Daniel Passino,Andrew Akers,Kevin Newell,Rob Small,Matt Akers,Bill to individuals,,2025-08-22 18:30:00,2025-08-22 20:30:00,,1110,,,,,,,,,1090,530
2025-08-23,7:30 a.m. ,Old Macdonald,Kevan Oyama,Mike Newell,Bob Owlett,Nick Zangardi,,,,2025-08-23 07:30:00,2025-08-23 12:00:00,,450,,,,,,,,,1100,540
2025-08-23,7:40 a.m. ,Old Macdonald,Cory Higgins,Brandon Itaoka,Jacob Emert,Zach Deines,,,,2025-08-23 07:40:00,2025-08-23 12:10:00,,460,,,,,,,,,1110,550
2025-08-23,7:50 a.m. ,Old Macdonald,Rob Small,Matt Akers,Andrew Akers,Kevin Newell,,,,2025-08-23 07:50:00,2025-08-23 12:20:00,,470,,,,,,,,,1120,560
2025-08-23,8:00 a.m. ,Old Macdonald,Johnathn Resetar,Ryan Hohn,Paul Parker,James Adolfson,,,,2025-08-23 08:00:00,2025-08-23 12:30:00,,480,,,,,,,,,1130,570
2025-08-23,8:10 a.m. ,Old Macdonald,Vikas Bhasin,Daniel Passino,Hisham Sayeedi,Daniel Passino,,,,2025-08-23 08:10:00,2025-08-23 12:40:00,,490,,,,,,,,,1140,580
2025-08-23,8:20 a.m. ,Old Macdonald,AD Hoffman,Bryan Wolfe,Will Quarles,Cory Micheel,,,,2025-08-23 08:20:00,2025-08-23 12:50:00,,500,,,,,,,,,1150,590
2025-08-23,1:10 p.m. ,Bandon Trails,Kevan Oyama,Ryan Hohn,Nick Zangardi,Zach Deines,,REPLAY,,2025-08-23 13:10:00,2025-08-23 17:40:00,,790,,,,,,,,,1160,600
2025-08-23,1:20 p.m. ,Bandon Trails,James Adolfson,Johnathn Resetar,Brandon Itaoka,Paul Parker,,,,,2025-08-23 13:20:00,2025-08-23 17:50:00,,800,,,,,,,,,1170,610
2025-08-23,1:30 p.m. ,Bandon Trails,Cory Micheel,Bob Owlett,Will Quarles,AD Hoffman,,,,,2025-08-23 13:30:00,2025-08-23 18:00:00,,810,,,,,,,,,1180,620
2025-08-23,1:10 p.m. ,Sheep Ranch,Cory Higgins,Matt Akers,Andrew Akers,Jacob Emert,,REPLAY,,2025-08-23 13:10:00,2025-08-23 17:40:00,,790,,,,,,,,,1190,630
2025-08-23,1:20 p.m.,Sheep Ranch,Mike Newell,Kevan Oyama,Nick Zangardi,Bryan Wolfe,,REPLAY,,2025-08-23 13:20:00,2025-08-23 17:50:00,,800,,,,,,,,,1200,640
2025-08-23,2:15 p.m. ,Bandon Preserve,Kevin Newell,Rob Small,Vikas Bhasin,Charlie Hildebrand,,Bill to individuals,,2025-08-23 14:15:00,2025-08-23 16:15:00,,855,,,,,,,,,1210,650
2025-08-23,6:00 p.m. ,Bandon Preserve,Hisham Sayeedi,Daniel Passino,+ replay from main course,,,Bill to individuals,,2025-08-23 18:00:00,2025-08-23 20:00:00,,1080,,,,,,,,,1220,660
2025-08-24, 7:00 a.m.,Sheep Ranch,Kevan Oyama,AD Hoffman,Kevin Newell,Rob Small,,,,2025-08-24 07:00:00,2025-08-24 11:30:00,,420,,,,,,,,,1230,670
2025-08-24,7:10 a.m. ,Sheep Ranch,Vikas Bhasin,Daniel Passino,Hisham Sayeedi,Charlie Hildebrand,,,,2025-08-24 07:10:00,2025-08-24 11:40:00,,430,,,,,,,,,1240,680
2025-08-24,7:20 a.m.,Sheep Ranch,Cory Higgins,Bob Owlett,Mike Newell,Cory Micheel,,,,2025-08-24 07:20:00,2025-08-24 11:50:00,,440,,,,,,,,,1250,690
2025-08-24,7:30 a.m.,Sheep Ranch,Zach Deines,Johnathn Resetar,Jacob Emert,Brandon Itaoka,,,,2025-08-24 07:30:00,2025-08-24 12:00:00,,450,,,,,,,,,1260,700
2025-08-24,7:40 a.m.,Sheep Ranch,James Adolfson,Ryan Hohn,Nick Zangardi,Paul Parker,,,,2025-08-24 07:40:00,2025-08-24 12:10:00,,460,,,,,,,,,1270,710
,,,,,,,,,,,,,,,,,,,,,,1280,720
,,,,,,,,,,,,,,,,,,,,,,1290,730
,,,,,,,,,,,,,,,,,,,,,,1300,740
,,,,,,,,,,,,,,,,,,,,,,1310,750
,,,,,,,,,,,,,,,,,,,,,,1320,760
,,,,,,,,,,,,,,,,,,,,,,1330,770
,,,,,,,,,,,,,,,,,,,,,,1340,780
,,,,,,,,,,,,,,,,,,,,,,1350,790
,,,,,,,,,,,,,,,,,,,,,,1360,800
,,,,,,,,,,,,,,,,,,,,,,1370,810
,,,,,,,,,,,,,,,,,,,,,,1380,820
,,,,,,,,,,,,,,,,,,,,,,1390,830
,,,,,,,,,,,,,,,,,,,,,,1400,840
,,,,,,,,,,,,,,,,,,,,,,1410,850
,,,,,,,,,,,,,,,,,,,,,,1420,860
,,,,,,,,,,,,,,,,,,,,,,1430,870
,,,,,,,,,,,,,,,,,,,,,,1440,880`;

        // Raw CSV data for caddy workbook
        const caddyWorkbookCsvData = `Timestamp,Email Address,Column 12,Caddy options - Please pick one option for each date [Wednesday 8/20 (PM round only)],Caddy options - Please pick one option for each date [Thursday 8/21 - AM Round],Caddy options - Please pick one option for each date [Thursday 8/21 - PM Round],Caddy options - Please pick one option for each date [Friday 8/22 - AM Round],Caddy options - Please pick one option for each date [Friday 8/22 - PM Round],Caddy options - Please pick one option for each date [Saturday 8/23 - AM Round],Caddy options - Please pick one option for each date [Saturday 8/23 - PM Round],Caddy options - Please pick one option for each date [Sunday 8/24 (AM round only)],Fancy Steak Dinner Saturday night?
7/15/2025 12:24:09,cory.higgins@gmail.com,Cory Higgins,Caddy,Caddy,No Caddy,Caddy,Caddy,Caddy,No Caddy,Caddy,Yes
7/17/2025 11:11:06,Paul.w.parker8@gmail.com,Paul Parker,No Caddy,No Caddy,Non-Carry Caddy,No Caddy,No Caddy,No Caddy,No Caddy,Non-Carry Caddy,Yes
7/17/2025 13:26:53,bryanwolfe1993@gmail.com,Bryan Wolfe,No Caddy,Non-Carry Caddy,No Caddy,Non-Carry Caddy,No Caddy,Non-Carry Caddy,No Caddy,Not Playing/Short Course,No
7/17/2025 14:20:36,johnresetar@hotmail.com,Johnathn Resetar,Carry Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,No Caddy,No Caddy,No Caddy,Yes
7/17/2025 14:30:07,bobowlett@gmail.com,Bob Owlett,No Caddy,Carry Caddy,No Caddy,Non-Carry Caddy,No Caddy,Carry Caddy,No Caddy,No Caddy,No
7/17/2025 15:00:23,nickzangardi@gmail.com,Nick Zangardi,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,No Caddy,No
7/19/2025 12:14:20,cory.micheel@gmail.com,Cory Micheel,Not Playing/Short Course,Non-Carry Caddy,No Caddy,Non-Carry Caddy,Carry Caddy,Non-Carry Caddy,No Caddy,No Caddy,No
7/22/2025 17:16:13,adonis.hoffman@gmail.com,AD Hoffman,Not Playing/Short Course,Non-Carry Caddy,No Caddy,Non-Carry Caddy,No Caddy,Non-Carry Caddy,No Caddy,Non-Carry Caddy,No
7/25/2025 09:00:00,mike.newell@gmail.com,Mike Newell,Carry Caddy,Carry Caddy,Carry Caddy,Carry Caddy,Carry Caddy,Carry Caddy,Carry Caddy,Carry Caddy,No
7/25/2025 09:00:00,kevin.newell@gmail.com,Kevin Newell,Carry Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No
7/25/2025 09:00:00,rob.small@gmail.com,Rob Small,Carry Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No
7/25/2025 09:00:00,jacob.emert@gmail.com,Jacob Emert,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No
7/25/2025 09:00:00,charlie.hildebrand@gmail.com,Charlie Hildebrand,No Caddy,Non-Carry Caddy,Non-Carry Caddy,Non-Carry Caddy,Not Playing/Short Course,Non-Carry Caddy,No Caddy,Carry Caddy,No
7/25/2025 09:00:00,kevan.oyama@gmail.com,Kevan Oyama,No Caddy,Carry Caddy,Non-Carry Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No
7/25/2025 09:00:00,hisham.sayeedi@gmail.com,Hisham Sayeedi,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No Caddy,Carry Caddy,No
`;

        // Handicap data provided by the user
        const handicaps = {
            "Mike Newell": 0.0,
            "Andrew Akers": 2,
            "James Adolfson": 3,
            "Cory Higgins": 3.3,
            "Kevan Oyama": 5,
            "Bob Owlett": 5,
            "Jacob Emert": 5.5,
            "Brandon Itaoka": 6.8,
            "Ryan Hohn": 7,
            "Zach Deines": 7.9,
            "Rob Small": 9,
            "Nick Zangardi": 8,
            "Vikas Bhasin": 11,
            "Daniel Passino": 11,
            "Hisham Sayeedi": 11,
            "Cory Micheel": 11,
            "AD Hoffman": 11,
            "Bryan Wolfe": 12,
            "Johnathn Resetar": 12.7,
            "Kevin Newell": 11.7,
            "Paul Parker": 13,
            "Will Quarles": 15,
            "Charlie Hildebrand": 15,
            "Matt Akers": 16.2
        };
        
        // Actual scores for all days provided by the user
        const allScoresData = {
            "2025-08-20": {
                "Mike Newell": 25,
                "Jacob Emert": 50,
                "Brandon Itaoka": 49,
                "Kevin Newell": 48,
                "Cory Micheel": 47,
                "Matt Akers": 46,
                "Andrew Akers": 45,
                "Bob Owlett": 44,
                "Zach Deines": 43,
                "Daniel Passino": 42,
                "AD Hoffman": 41,
                "Will Quarles": 40,
                "James Adolfson": 39,
                "Kevan Oyama": 38,
                "Rob Small": 37,
                "Hisham Sayeedi": 36,
                "Bryan Wolfe": 35,
                "Charlie Hildebrand": 34,
                "Cory Higgins": 33,
                "Ryan Hohn": 32,
                "Nick Zangardi": 31,
                "Vikas Bhasin": 30,
                "Johnathn Resetar": 29,
                "Paul Parker": 28
            },
            "2025-08-21": {
                "Mike Newell": 31,
                "Andrew Akers": 52,
                "James Adolfson": 34,
                "Cory Higgins": 35,
                "Kevan Oyama": 29,
                "Bob Owlett": 30,
                "Brandon Itaoka": 55,
                "Jacob Emert": 36,
                "Ryan Hohn": 32,
                "Zach Deines": 44,
                "Rob Small": 26,
                "Nick Zangardi": 47,
                "Vikas Bhasin": 31,
                "Hisham Sayeedi": 36,
                "Daniel Passino": 25,
                "Kevin Newell": 38,
                "Cory Micheel": 52,
                "AD Hoffman": 42,
                "Johnathn Resetar": 42,
                "Bryan Wolfe": 36,
                "Paul Parker": 48,
                "Charlie Hildebrand": 42,
                "Will Quarles": 46,
                "Matt Akers": 51
            },
            "2025-08-22": {
                "Mike Newell": 34,
                "Andrew Akers": 34,
                "James Adolfson": 40,
                "Cory Higgins": 25,
                "Kevan Oyama": 46,
                "Bob Owlett": 41,
                "Brandon Itaoka": 27,
                "Jacob Emert": 43,
                "Ryan Hohn": 52,
                "Zach Deines": 37,
                "Rob Small": 33,
                "Nick Zangardi": 36,
                "Vikas Bhasin": 44,
                "Hisham Sayeedi": 31,
                "Daniel Passino": 46,
                "Kevin Newell": 37,
                "Cory Micheel": 36,
                "AD Hoffman": 27,
                "Johnathn Resetar": 39,
                "Bryan Wolfe": 55,
                "Paul Parker": 53,
                "Charlie Hildebrand": 49,
                "Will Quarles": 32,
                "Matt Akers": 43
            },
            "2025-08-23": {
                "Mike Newell": 39,
                "Andrew Akers": 47,
                "James Adolfson": 36,
                "Cory Higgins": 46,
                "Kevan Oyama": 53,
                "Bob Owlett": 30,
                "Brandon Itaoka": 38,
                "Jacob Emert": 40,
                "Ryan Hohn": 34,
                "Zach Deines": 49,
                "Rob Small": 47,
                "Nick Zangardi": 25,
                "Vikas Bhasin": 38,
                "Hisham Sayeedi": 51,
                "Daniel Passino": 31,
                "Kevin Newell": 47,
                "Cory Micheel": 29,
                "AD Hoffman": 50,
                "Johnathn Resetar": 55,
                "Bryan Wolfe": 32,
                "Paul Parker": 33,
                "Charlie Hildebrand": 35,
                "Will Quarles": 29,
                "Matt Akers": 42
            },
            "2025-08-24": {
                "Mike Newell": 45,
                "Andrew Akers": 55,
                "James Adolfson": 55,
                "Cory Higgins": 44,
                "Kevan Oyama": 38,
                "Bob Owlett": 51,
                "Brandon Itaoka": 50,
                "Jacob Emert": 26,
                "Ryan Hohn": 49,
                "Zach Deines": 47,
                "Rob Small": 36,
                "Nick Zangardi": 55,
                "Vikas Bhasin": 31,
                "Hisham Sayeedi": 26,
                "Daniel Passino": 52,
                "Kevin Newell": 36,
                "Cory Micheel": 38,
                "AD Hoffman": 39,
                "Johnathn Resetar": 45,
                "Bryan Wolfe": 29,
                "Paul Parker": 54,
                "Charlie Hildebrand": 43,
                "Will Quarles": 44,
                "Matt Akers": 30
            }
        };

        // Meal data provided by the user
        const mealsData = {
            "Kevin Newell": { "Breakfast Buffet": 1, "Lunch Box": 1 },
            "Ryan Hohn": { "Breakfast Buffet": 1, "Lunch Box": 1 },
            "Johnathn Resetar": { "Breakfast Buffet": 1, "Lunch Box": 1 },
            "Charlie Hildebrand": { "Breakfast Buffet": 1, "Lunch Box": 1 },
            "Rob Small": { "Breakfast Buffet": 1, "Lunch Box": 1 },
            "Mike Newell": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Cory Higgins": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Zach Deines": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Vikas Bhasin": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Jacob Emert": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Brandon Itaoka": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Nick Zangardi": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Andrew Akers": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Hisham Sayeedi": { "Breakfast Buffet": 0, "Lunch Box": 1 }, // Updated Hisham Sayeedi's Lunch Box to 1
            "Daniel Passino": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Matt Akers": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Bryan Wolfe": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Bob Owlett": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Kevan Oyama": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Cory Micheel": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "AD Hoffman": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Paul Parker": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "James Adolfson": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Will Quarles": { "Breakfast Buffet": 0, "Lunch Box": 0 }
        };

        // Global variable to store parsed caddy selections
        const caddySelectionsByPlayerRound = {};
        const parsedTeeTimes = [];
        let dailyTeams = {}; // Global variable to store teams for each day
        let dailyScores = {}; // Global variable to store mock scores for each day

        // Dates for the trip
        const scoringDates = ['2025-08-20', '2025-08-21', '2025-08-22', '2025-08-23', '2025-08-24'];

        function parseCSV(csv) {
            const lines = csv.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) return [];

            const data = [];
            // Define fixed indices for relevant columns based on the CSV structure
            const dateIndex = 0;
            const timeIndex = 1;
            const courseIndex = 2;
            const playerIndices = [3, 4, 5, 6]; // Indices for Player columns (C, D, E, F)
            const caddieIndex = 7; // Index for 'Caddie?' column
            const notesIndex = 8; // Index for 'Notes' column
            const completeEstimateIndex = 11; // Index for 'Complete Estimate' column (L)

            for (let i = 1; i < lines.length; i++) {
                const currentLine = lines[i].split(',');

                // Ensure the line has enough columns to avoid index out of bounds
                if (currentLine.length <= Math.max(...playerIndices, completeEstimateIndex)) continue;

                const row = {};
                row['Date'] = currentLine[dateIndex] ? currentLine[dateIndex].trim() : '';
                row['Time'] = currentLine[timeIndex] ? currentLine[timeIndex].trim() : '';
                row['Course'] = currentLine[courseIndex] ? currentLine[courseIndex].trim() : '';
                row['Caddie?'] = currentLine[caddieIndex] ? currentLine[caddieIndex].trim() : '';
                row['Notes'] = currentLine[notesIndex] ? currentLine[notesIndex].trim() : '';
                row['CompleteEstimate'] = currentLine[completeEstimateIndex] ? currentLine[completeEstimateIndex].trim() : '';


                // Assign players to unique keys based on their their fixed indices
                row['Player1'] = currentLine[playerIndices[0]] ? currentLine[playerIndices[0]].trim() : '';
                row['Player2'] = currentLine[playerIndices[1]] ? currentLine[playerIndices[1]].trim() : '';
                row['Player3'] = currentLine[playerIndices[2]] ? currentLine[playerIndices[2]].trim() : '';
                row['Player4'] = currentLine[playerIndices[3]] ? currentLine[playerIndices[3]].trim() : '';

                // Only add row if it has essential data and at least one player
                if (row['Date'] && row['Time'] && row['Course'] &&
                    (row['Player1'] || row['Player2'] || row['Player3'] || row['Player4'])) {
                    data.push(row);
                }
            }
            return data;
        }

        function parseCaddyWorkbookCSV(csv) {
            const lines = csv.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) return;

            const headers = lines[0].split(',').map(h => h.trim());
            const playerColumnIndex = 2; // "Column 12" is the player name now
            const caddyColumnIndices = [];
            const caddyColumnMap = {}; // Maps header index to { date: 'YYYY-MM-DD', roundType: 'AM' | 'PM' }

            // Parse caddy headers to create a map for lookup
            headers.forEach((header, index) => {
                if (header.includes("Caddy options - Please pick one option for each date")) {
                    const match = header.match(/\[.*? (\d{1,2}\/\d{1,2})(?: - (AM|PM) Round)?(?: \((AM|PM) round only\))?\]/);
                    if (match) {
                        const monthDay = match[1]; // e.g., "8/20"
                        let roundType = '';

                        // Determine round type based on specific phrases or explicit "AM/PM Round"
                        if (header.includes("(PM round only)")) {
                            roundType = 'PM';
                        } else if (header.includes("(AM round only)")) {
                            roundType = 'AM';
                        } else if (match[2]) { // If "AM Round" or "PM Round" is explicitly stated
                            roundType = match[2];
                        }

                        // Construct YYYY-MM-DD date string (assuming 2025 as per original data)
                        const [month, day] = monthDay.split('/');
                        const fullDate = `2025-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;

                        if (roundType) { // Only add if roundType is determined
                            caddyColumnIndices.push(index);
                            caddyColumnMap[index] = { date: fullDate, roundType: roundType };
                        }
                    }
                }
            });

            // Populate caddySelectionsByPlayerRound
            for (let i = 1; i < lines.length; i++) {
                const currentLine = lines[i].split(',');
                const playerName = currentLine[playerColumnIndex] ? currentLine[playerColumnIndex].trim() : '';
                if (!playerName) continue;

                caddySelectionsByPlayerRound[playerName] = {};

                caddyColumnIndices.forEach(colIndex => {
                    let caddyType = currentLine[colIndex] ? currentLine[colIndex].trim() : 'No Caddy';

                    // Apply transformations
                    if (caddyType.includes("Non-carry Strategy Caddy") || caddyType.includes("$40") || caddyType.toLowerCase() === "fore caddy") {
                        caddyType = "Non-Carry Caddy";
                    } else if (caddyType.includes("Carry Caddy") || caddyType.includes("$100") || caddyType === "Caddy") {
                        caddyType = "Carry Caddy";
                    } else if (caddyType.includes("Not Playing") || caddyType === "Not Playing/Short Course") {
                        caddyType = "Not Playing";
                    }

                    const { date, roundType } = caddyColumnMap[colIndex];

                    if (!caddySelectionsByPlayerRound[playerName][date]) {
                        caddySelectionsByPlayerRound[playerName][date] = {};
                    }
                    caddySelectionsByPlayerRound[playerName][date][roundType] = caddyType;
                });
            }
        }


        function populatePlayerSelect(players) {
            const playerSelect = document.getElementById('player-select');
            // Check if playerSelect exists before trying to manipulate it
            if (playerSelect) {
                playerSelect.innerHTML = ''; // Clear existing options

                // Sort players alphabetically
                const sortedPlayers = [...players].sort();

                sortedPlayers.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player;
                    option.textContent = player;
                    playerSelect.appendChild(option);
                });
            }
        }

        function populateNotes(playerName) {
            const notesBody = document.getElementById('notes-table-body');
            notesBody.innerHTML = ''; // Clear existing notes

            // Static notes
            const staticNotes = [
                "Welcome dinner at Trail's End 8:30 p.m."
            ];

            staticNotes.forEach(note => {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.className = 'border px-4 py-2';
                td.textContent = note;
                tr.appendChild(td);
                notesBody.appendChild(tr);
            });

            // Dynamic meal notes
            const playerMeals = mealsData[playerName];
            if (playerMeals) {
                const breakfastStatus = playerMeals["Breakfast Buffet"] === 1 ? "Yes" : "No";
                const lunchStatus = playerMeals["Lunch Box"] === 1 ? "Yes" : "No";

                let trBreakfast = document.createElement('tr');
                let tdBreakfast = document.createElement('td');
                tdBreakfast.className = 'border px-4 py-2';
                tdBreakfast.textContent = `Breakfast: ${breakfastStatus}`;
                trBreakfast.appendChild(tdBreakfast);
                notesBody.appendChild(trBreakfast);

                let trLunch = document.createElement('tr');
                let tdLunch = document.createElement('td');
                tdLunch.className = 'border px-4 py-2';
                tdLunch.textContent = `Lunch: ${lunchStatus}`;
                trLunch.appendChild(tdLunch);
                notesBody.appendChild(trLunch);

            } else {
                // If meal data not found for the player
                let trBreakfast = document.createElement('tr');
                let tdBreakfast = document.createElement('td');
                tdBreakfast.className = 'border px-4 py-2';
                tdBreakfast.textContent = `Breakfast: N/A`;
                trBreakfast.appendChild(tdBreakfast);
                notesBody.appendChild(trBreakfast);

                let trLunch = document.createElement('tr');
                let tdLunch = document.createElement('td');
                tdLunch.className = 'border px-4 py-2';
                tdLunch.textContent = `Lunch: N/A`;
                trLunch.appendChild(tdLunch);
                notesBody.appendChild(trLunch);
            }
        }


        function populateTeeTimesForPlayer(playerName) {
            const pairingsBody = document.getElementById('tee-time-pairings-body');
            const currentPlayerTitle = document.getElementById('current-player-tee-times-title');
            const mainTripSummaryTitle = document.getElementById('main-trip-summary-title'); // Get main title element
            const stablefordTableBody = document.querySelector('#stableford-table tbody'); // Get stableford table body
            const parsedData = parseCSV(csvData);

            // Update the main title dynamically
            const baseTitle = "Bandon Dunes Golf Trip Summary";
            mainTripSummaryTitle.textContent = `${playerName} - ${baseTitle}`;
            // Update the section title
            currentPlayerTitle.textContent = `${playerName}'s Tee Time Pairings`;

            // Clear existing rows
            pairingsBody.innerHTML = '';

            // Clear existing handicap row in Stableford table and spacing row
            const existingHandicapRow = stablefordTableBody.querySelector('.player-handicap-row');
            if (existingHandicapRow) {
                existingHandicapRow.remove();
            }
            const existingSpacingRow = stablefordTableBody.querySelector('.spacing-row');
            if (existingSpacingRow) {
                existingSpacingRow.remove();
            }

            // Add spacing row *before* handicap row
            const spacingTr = document.createElement('tr');
            spacingTr.className = 'spacing-row';
            spacingTr.innerHTML = '<td colspan="4"></td>'; // Span all columns
            stablefordTableBody.appendChild(spacingTr);

            // Add selected player's handicap to Stableford table
            const playerHandicap = handicaps[playerName];
            if (playerHandicap !== undefined) {
                const tr = document.createElement('tr');
                tr.className = 'player-handicap-row'; // Add a class to easily find and remove later
                const tdLabel = document.createElement('td');
                tdLabel.className = 'border px-4 py-2 font-semibold';
                tdLabel.textContent = `${playerName}'s Handicap`;
                tr.appendChild(tdLabel);
                const tdValue = document.createElement('td');
                tdValue.className = 'border px-4 py-2 bg-white'; // Set background to white
                tdValue.textContent = playerHandicap;
                tr.appendChild(tdValue);
                // Merge the remaining two cells (columns 3 and 4)
                const tdMerged = document.createElement('td');
                tdMerged.className = 'border px-4 py-2 bg-white'; // Set background to white
                tdMerged.colSpan = 2; // Span 2 columns
                tr.appendChild(tdMerged);
                stablefordTableBody.appendChild(tr);
            }

            // Filter data for the specific player
            let playerTeeTimes = parsedData.filter(row => {
                // Check all possible player columns for the playerName
                return (row['Player1'] === playerName ||
                        row['Player2'] === playerName ||
                        row['Player3'] === playerName ||
                        row['Player4'] === playerName);
            });

            // Sort tee times by date and then by time for accurate "last round" identification
            playerTeeTimes.sort((a, b) => {
                const dateA = new Date(a['Date'] + ' ' + a['Time'].replace('a.m.', 'AM').replace('p.m.', 'PM'));
                const dateB = new Date(b['Date'] + ' ' + b['Time'].replace('a.m.', 'AM').replace('p.m.', 'PM'));
                return dateA - dateB;
            });

            // Iterate through the filtered and sorted data and create table rows
            playerTeeTimes.forEach(row => {
                const tr = document.createElement('tr');

                const dateTd = document.createElement('td');
                dateTd.className = 'px-4 py-2';
                // Format the date: "Wed - 8/20"
                const dateParts = row['Date'].split('-'); // Split YYYY-MM-DD
                const year = parseInt(dateParts[0]);
                const month = parseInt(dateParts[1]) - 1; // Month is 0-indexed
                const day = parseInt(dateParts[2]);
                const dateObj = new Date(year, month, day);

                const options = { weekday: 'short', month: 'numeric', day: 'numeric' };
                dateTd.textContent = dateObj.toLocaleDateString('en-US', options).replace(',', ' -'); // "Wed, 8/20" to "Wed - 8/20"
                tr.appendChild(dateTd);

                const timeTd = document.createElement('td');
                timeTd.className = 'px-4 py-2';
                timeTd.textContent = row['Time'];
                tr.appendChild(timeTd);

                // Add Estimated Completion Time
                const completeTimeTd = document.createElement('td');
                completeTimeTd.className = 'px-4 py-2';
                const fullDateTime = row['CompleteEstimate'];
                if (fullDateTime) {
                    // Assuming fullDateTime is like "YYYY-MM-DD HH:MM:SS" or "HH:MM"
                    let timeString = fullDateTime.includes(' ') ? fullDateTime.split(' ')[1] : fullDateTime;
                    let [hours, minutes] = timeString.split(':').map(Number);
                    let ampm = hours >= 12 ? 'p.m.' : 'a.m.';
                    hours = hours % 12;
                    hours = hours ? hours : 12; // The hour '0' should be '12'
                    const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
                    completeTimeTd.textContent = `${hours}:${formattedMinutes} ${ampm}`;
                } else {
                    completeTimeTd.textContent = 'N/A';
                }
                tr.appendChild(completeTimeTd);


                const courseTd = document.createElement('td');
                courseTd.className = 'px-4 py-2';
                courseTd.textContent = row['Course'];
                tr.appendChild(courseTd);

                // Determine round type (AM/PM) from the tee time
                let teeTimeHours = parseInt(row['Time'].split(':')[0]);
                let teeTimeAmPm = row['Time'].toLowerCase().includes('p.m.') ? 'PM' : 'AM';

                // Handle 12 AM/PM
                if (row['Time'].toLowerCase().startsWith('12') && row['Time'].toLowerCase().includes('a.m.')) {
                    teeTimeAmPm = 'AM'; // 12 AM
                } else if (row['Time'].toLowerCase().startsWith('12') && row['Time'].toLowerCase().includes('p.m.')) {
                    teeTimeAmPm = 'PM'; // 12 PM
                }


                // Get caddie selection for this specific round from the new caddy data
                let caddyTypeForRound = 'N/A';
                if (caddySelectionsByPlayerRound[playerName] &&
                    caddySelectionsByPlayerRound[playerName][row['Date']] &&
                    caddySelectionsByPlayerRound[playerName][row['Date']][teeTimeAmPm]) {
                        caddyTypeForRound = caddySelectionsByPlayerRound[playerName][row['Date']][teeTimeAmPm];
                }

                const caddieTd = document.createElement('td');
                caddieTd.className = 'px-4 py-2';
                caddieTd.textContent = caddyTypeForRound;
                tr.appendChild(caddieTd);

                const partnersTd = document.createElement('td');
                partnersTd.className = 'px-4 py-2';
                const partners = [];
                // Check all possible player columns, excluding the current player
                for (let i = 1; i <= 4; i++) {
                    const player = row[`Player${i}`];
                    if (player && player !== playerName && player !== 'TBD') {
                        const partnerHandicap = handicaps[player];
                        partners.push(`${player} (${handicaps[player] !== undefined ? handicaps[player] : 'N/A'})`);
                    }
                }
                partnersTd.textContent = partners.join(', ');
                tr.appendChild(partnersTd);

                pairingsBody.appendChild(tr);
            });
        }


        function populateDailyPairings() {
            const dailyPairingsBody = document.getElementById('daily-pairings-body');
            dailyPairingsBody.innerHTML = '';
            const parsedData = parseCSV(csvData);

            // Group pairings by date
            const pairingsByDate = {};
            parsedData.forEach(row => {
                if (!pairingsByDate[row.Date]) {
                    pairingsByDate[row.Date] = [];
                }
                pairingsByDate[row.Date].push(row);
            });

            // Iterate over each date
            Object.keys(pairingsByDate).sort().forEach(date => {
                const dailyPairings = pairingsByDate[date];
                dailyPairings.forEach((row, index) => {
                    const tr = document.createElement('tr');
                    // Add class for a bold line if it's the last tee time of the day
                    if (index === dailyPairings.length - 1) {
                        tr.className = 'last-tee-time-of-day';
                    }

                    const dateTd = document.createElement('td');
                    dateTd.className = 'px-4 py-2';
                    const dateParts = row.Date.split('-');
                    const dateObj = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
                    const options = { weekday: 'short', month: 'numeric', day: 'numeric' };
                    dateTd.textContent = dateObj.toLocaleDateString('en-US', options).replace(',', ' -');
                    tr.appendChild(dateTd);

                    const timeTd = document.createElement('td');
                    timeTd.className = 'px-4 py-2';
                    timeTd.textContent = row.Time;
                    tr.appendChild(timeTd);

                    const completeTimeTd = document.createElement('td');
                    completeTimeTd.className = 'px-4 py-2';
                    const fullDateTime = row['CompleteEstimate'];
                    if (fullDateTime) {
                        let timeString = fullDateTime.includes(' ') ? fullDateTime.split(' ')[1] : fullDateTime;
                        let [hours, minutes] = timeString.split(':').map(Number);
                        let ampm = hours >= 12 ? 'p.m.' : 'a.m.';
                        hours = hours % 12;
                        hours = hours ? hours : 12;
                        const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
                        completeTimeTd.textContent = `${hours}:${formattedMinutes} ${ampm}`;
                    } else {
                        completeTimeTd.textContent = 'N/A';
                    }
                    tr.appendChild(completeTimeTd);

                    const courseTd = document.createElement('td');
                    courseTd.className = 'px-4 py-2';
                    courseTd.textContent = row.Course;
                    tr.appendChild(courseTd);

                    const allPlayersTd = document.createElement('td');
                    allPlayersTd.className = 'px-4 py-2';
                    const players = [];
                    for (let i = 1; i <= 4; i++) {
                        const player = row[`Player${i}`];
                        if (player && player !== 'TBD') {
                            const playerHandicap = handicaps[player];
                            players.push(`${player} (${playerHandicap !== undefined ? playerHandicap : 'N/A'})`);
                        }
                    }
                    allPlayersTd.innerHTML = players.join('<br>');
                    tr.appendChild(allPlayersTd);

                    dailyPairingsBody.appendChild(tr);
                });
            });
        }


        function populateCaddySummary() {
            const caddySummaryBody = document.getElementById('caddy-summary-body');
            const caddySummaryHeaderRow = document.getElementById('caddy-summary-header-row');
            caddySummaryBody.innerHTML = '';
            // Clear existing headers
            const existingHeaders = caddySummaryHeaderRow.querySelectorAll('th:not(:first-child)');
            existingHeaders.forEach(th => th.remove());

            const players = Object.keys(handicaps).sort();
            const datesWithRounds = new Set();
            
            // Collect all unique dates with rounds from the parsed caddy data
            Object.values(caddySelectionsByPlayerRound).forEach(playerData => {
                Object.keys(playerData).forEach(date => {
                    Object.keys(playerData[date]).forEach(roundType => {
                        datesWithRounds.add(`${date}-${roundType}`);
                    });
                });
            });

            const sortedDates = [...datesWithRounds].sort();

            // Add dynamic headers
            sortedDates.forEach(dateRound => {
                const parts = dateRound.split('-');
                const roundType = parts.pop();
                const date = parts.join('-');
                
                const th = document.createElement('th');
                th.className = 'px-4 py-2';
                const dateParts = date.split('-');
                const dateObj = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
                const options = { weekday: 'short', month: 'numeric', day: 'numeric' };
                th.textContent = `${dateObj.toLocaleDateString('en-US', options).replace(',', '')} (${roundType})`;
                caddySummaryHeaderRow.appendChild(th);
            });


            players.forEach(player => {
                const tr = document.createElement('tr');
                const playerTd = document.createElement('td');
                playerTd.className = 'px-4 py-2 font-semibold';
                playerTd.textContent = player;
                tr.appendChild(playerTd);

                sortedDates.forEach(dateRound => {
                    const parts = dateRound.split('-');
                    const roundType = parts.pop();
                    const date = parts.join('-');
                    
                    const caddyTd = document.createElement('td');
                    caddyTd.className = 'px-4 py-2';
                    const caddyType = caddySelectionsByPlayerRound[player]?.[date]?.[roundType] || 'N/A';
                    caddyTd.textContent = caddyType;
                    tr.appendChild(caddyTd);
                });

                caddySummaryBody.appendChild(tr);
            });
        }

        // New function to populate the caddy summary by tee time table
        function populateCaddySummaryByTeeTime() {
            const teeTimeSummaryBody = document.getElementById('caddy-tee-time-summary-body');
            if (!teeTimeSummaryBody) return;
            teeTimeSummaryBody.innerHTML = '';
            
            const parsedData = parseCSV(csvData);

            // Group tee times by date
            const teeTimesByDate = {};
            parsedData.forEach(row => {
                if (!teeTimesByDate[row.Date]) {
                    teeTimesByDate[row.Date] = [];
                }
                teeTimesByDate[row.Date].push(row);
            });

            Object.keys(teeTimesByDate).sort().forEach(date => {
                const dailyTeeTimes = teeTimesByDate[date];
                dailyTeeTimes.forEach(row => {
                    const tr = document.createElement('tr');

                    const dateTd = document.createElement('td');
                    const dateParts = row.Date.split('-');
                    const dateObj = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]);
                    const options = { weekday: 'short', month: 'numeric', day: 'numeric' };
                    dateTd.textContent = dateObj.toLocaleDateString('en-US', options).replace(',', ' -');
                    dateTd.className = 'px-4 py-2';
                    tr.appendChild(dateTd);

                    const timeTd = document.createElement('td');
                    timeTd.textContent = row.Time;
                    timeTd.className = 'px-4 py-2';
                    tr.appendChild(timeTd);

                    const courseTd = document.createElement('td');
                    courseTd.textContent = row.Course;
                    courseTd.className = 'px-4 py-2';
                    tr.appendChild(courseTd);

                    const playersAndCaddiesTd = document.createElement('td');
                    playersAndCaddiesTd.className = 'px-4 py-2';

                    let teeTimeAmPm = row['Time'].toLowerCase().includes('p.m.') ? 'PM' : 'AM';
                    if (row['Time'].toLowerCase().startsWith('12') && row['Time'].toLowerCase().includes('a.m.')) {
                        teeTimeAmPm = 'AM';
                    } else if (row['Time'].toLowerCase().startsWith('12') && row['Time'].toLowerCase().includes('p.m.')) {
                        teeTimeAmPm = 'PM';
                    }

                    const players = [row.Player1, row.Player2, row.Player3, row.Player4];
                    const playersWithCaddies = players.filter(player => player && player !== 'TBD').map(player => {
                        const caddyChoice = caddySelectionsByPlayerRound[player]?.[date]?.[teeTimeAmPm] || 'No Caddy';
                        return `${player} - ${caddyChoice}`;
                    });

                    playersAndCaddiesTd.innerHTML = playersWithCaddies.join('<br>');
                    tr.appendChild(playersAndCaddiesTd);

                    const caddySummaryTd = document.createElement('td');
                    caddySummaryTd.className = 'px-4 py-2';
                    const caddyCounts = players.reduce((counts, player) => {
                        if (player && player !== 'TBD') {
                            const caddyChoice = caddySelectionsByPlayerRound[player]?.[date]?.[teeTimeAmPm] || 'No Caddy';
                            if (caddyChoice !== 'No Caddy') {
                                counts[caddyChoice] = (counts[caddyChoice] || 0) + 1;
                            }
                        }
                        return counts;
                    }, {});

                    const summaryString = Object.keys(caddyCounts).map(type => `${type}: ${caddyCounts[type]}`).join(', ');
                    caddySummaryTd.textContent = summaryString || 'No Caddies';
                    tr.appendChild(caddySummaryTd);

                    teeTimeSummaryBody.appendChild(tr);
                    
                    // Add a bold line separator after all tee times for a date
                    if (dailyTeeTimes.indexOf(row) === dailyTeeTimes.length - 1) {
                         const separatorTr = document.createElement('tr');
                         separatorTr.className = 'caddy-summary-separator';
                         separatorTr.innerHTML = '<td colspan="5"></td>';
                         teeTimeSummaryBody.appendChild(separatorTr);
                    }
                });
            });
        }


        // Function to create teams for a given day
        function createDailyTeams(players, previousDayScores) {
            let playersWithRank = [];
            const numTeams = 6;
            const teams = Array.from({ length: numTeams }, () => []);

            // If it's the first day, rank by handicap
            if (!previousDayScores) {
                playersWithRank = players.map(name => ({
                    name,
                    handicap: handicaps[name],
                    score: null
                }));
                // Sort by handicap ascending for the first day
                playersWithRank.sort((a, b) => a.handicap - b.handicap);
            } else {
                // For subsequent days, rank by previous day's score with a handicap tie-breaker
                playersWithRank = players.map(name => ({
                    name,
                    handicap: handicaps[name],
                    score: previousDayScores[name]
                }));
                // Sort players by previous day's score (higher is better), then by handicap (lower is better)
                playersWithRank.sort((a, b) => {
                    if (b.score !== a.score) {
                        return b.score - a.score;
                    }
                    return a.handicap - b.handicap;
                });
            }

            // Snake draft logic
            for (let i = 0; i < playersWithRank.length; i++) {
                const player = playersWithRank[i];
                if (Math.floor(i / numTeams) % 2 === 0) {
                    teams[i % numTeams].push(player);
                } else {
                    teams[numTeams - 1 - (i % numTeams)].push(player);
                }
            }
            return teams;
        }

        function generateMockScores(players, previousDayScores) {
            const scores = {};
            players.forEach(player => {
                // Generate a score based on previous day's score or handicap
                let baseScore = 25; // Base score for a decent day
                if (previousDayScores && previousDayScores[player] !== undefined) {
                    // Use previous day's performance to influence today's score
                    // Example: A better score yesterday (higher number) might lead to a slightly higher score today
                    baseScore = previousDayScores[player];
                } else {
                    // For the first day, use handicap as a base
                    baseScore = 25 - handicaps[player];
                }
                
                // Add some random variation
                const score = Math.max(0, Math.floor(baseScore + (Math.random() * 10 - 5)));
                scores[player] = score;
            });
            return scores;
        }

        // Function to populate a single scoring table for a given date
        function populateScoringTable(date, teamsForDay, scoresForDay) {
            const scoringBody = document.getElementById(`scoring-body-${date.split('-').slice(1).join('-')}`);
            if (!scoringBody) return;
            scoringBody.innerHTML = '';
            
            // Calculate team total scores and find the winning team
            const teamTotals = teamsForDay.map(team => 
                team.reduce((sum, player) => sum + (scoresForDay[player.name] || 0), 0)
            );
            const winningTeamScore = Math.max(...teamTotals);
            
            teamsForDay.forEach((team, teamIndex) => {
                const teamTotalScore = teamTotals[teamIndex];
                
                let rowsForTeam = [];
                team.forEach(player => {
                    const playerScore = scoresForDay[player.name] || 'N/A';
                    
                    const tr = document.createElement('tr');
                    
                    const playerTd = document.createElement('td');
                    playerTd.className = 'px-4 py-2';
                    playerTd.textContent = player.name;
                    tr.appendChild(playerTd);
                    
                    const handicapTd = document.createElement('td');
                    handicapTd.className = 'px-4 py-2';
                    handicapTd.textContent = player.handicap;
                    tr.appendChild(handicapTd);
                    
                    const scoreTd = document.createElement('td');
                    scoreTd.className = 'px-4 py-2';
                    scoreTd.textContent = playerScore;
                    tr.appendChild(scoreTd);
                    
                    rowsForTeam.push(tr);
                });

                if (rowsForTeam.length > 0) {
                    const firstRow = rowsForTeam[0];
                    
                    const teamTd = document.createElement('td');
                    teamTd.rowSpan = team.length;
                    teamTd.className = 'px-4 py-2 team-header';
                    teamTd.textContent = `Team ${teamIndex + 1}`;
                    firstRow.prepend(teamTd);
                    
                    const teamTotalCell = document.createElement('td');
                    teamTotalCell.rowSpan = team.length;
                    teamTotalCell.className = 'px-4 py-2 font-bold';
                    teamTotalCell.textContent = teamTotalScore;
                    firstRow.appendChild(teamTotalCell);
                }

                // Append rows to the table body
                rowsForTeam.forEach(row => {
                    if (teamTotalScore === winningTeamScore) {
                        row.classList.add('winning-team-highlight');
                    }
                    scoringBody.appendChild(row);
                });
            });
        }


        function initialize() {
            // First, parse all the data once
            const allPlayers = Object.keys(handicaps);
            const parsedMainData = parseCSV(csvData);
            parseCaddyWorkbookCSV(caddyWorkbookCsvData);

            // Populate the player dropdown with all player names
            populatePlayerSelect(allPlayers);

            // Initial population of the tables
            const initialPlayer = allPlayers[0];
            populateTeeTimesForPlayer(initialPlayer);
            populateNotes(initialPlayer);
            populateDailyPairings();
            populateCaddySummary();
            populateCaddySummaryByTeeTime();

            // Create and populate all scoring tables with dynamic teams
            let previousDayScores = null;

            scoringDates.forEach(date => {
                const dateKey = date; // e.g., '2025-08-20'
                const playersList = Object.keys(handicaps); // Use the keys from handicaps to get all players

                let currentDayScores = {};
                // Use actual scores for 8/20, generate mock scores for other days
                if (allScoresData[dateKey]) {
                    currentDayScores = allScoresData[dateKey];
                } else {
                    currentDayScores = generateMockScores(playersList, previousDayScores);
                }
                dailyScores[dateKey] = currentDayScores;
                
                // Create teams for the current day based on previous day's scores or handicaps
                dailyTeams[dateKey] = createDailyTeams(playersList, previousDayScores);

                // Populate the table for the current day
                populateScoringTable(dateKey, dailyTeams[dateKey], dailyScores[dateKey]);

                // Set the current day's scores as the previous day's scores for the next iteration
                previousDayScores = currentDayScores;
            });


            // Add event listeners
            document.getElementById('player-select').addEventListener('change', (event) => {
                const selectedPlayer = event.target.value;
                populateTeeTimesForPlayer(selectedPlayer);
                populateNotes(selectedPlayer);
            });

            // Tab functionality
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons and content
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                    // Add active class to the clicked button and its corresponding content
                    button.classList.add('active');
                    const targetId = button.id.replace('tab-', 'content-');
                    document.getElementById(targetId).classList.add('active');
                });
            });
        }

        window.onload = initialize;
    </script>
</body>
</html>
