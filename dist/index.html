<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bandon Dunes Golf Trip Summary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
            background-color: #fff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative; /* Added for logo positioning */
        }
        #trip-logo {
            position: absolute;
            top: 2rem;
            right: 2rem;
            width: 120px;
            height: auto;
        }
        .card {
            background-color: #fff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .table-auto {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        .table-auto th, .table-auto td {
            padding: 0.75rem;
            border-bottom: 1px solid #e2e8f0;
            text-align: left;
        }
        .table-auto th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #4a5568;
            text-transform: uppercase;
            font-size: 0.875rem;
        }
        .table-auto tr:last-child td {
            border-bottom: none;
        }
        .table-auto tbody tr:hover {
            background-color: #f0f4f8;
        }
        h1 {
            font-size: 2.25rem;
            margin-bottom: 1.5rem;
        }
        h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        h3 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
        }
        .flex-col.md\:flex-row {
            flex-direction: column;
        }
        @media (min-width: 768px) {
            .flex-col.md\:flex-row {
                flex-direction: row;
            }
            .flex-1.md\:w-1\/2 {
                width: 50%;
            }
        }
        .player-handicap-row td {
            background-color: #e0f2fe;
        }
        .highlight-player {
            background-color: #fef08a;
            padding: 0 0.25rem;
            border-radius: 0.25rem;
        }
        .spacing-row td {
            height: 1rem;
            border-bottom: none;
        }
        .last-tee-time-of-day td {
            border-bottom: 2px solid #a0a0a0;
        }
        .tab-button {
            padding: 0.75rem 1.5rem;
            border-bottom: 2px solid transparent;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .tab-button.active {
            border-color: #10b981;
            color: #10b981;
        }
        .tab-button:hover {
            color: #059669;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .caddy-player-highlight {
            background-color: #d1fae5;
        }
        .team-header {
            background-color: #6ee7b7;
            font-size: 1.125rem;
            font-weight: 700;
        }
        .caddy-summary-separator {
            border-bottom: 2px solid #a0a0a0;
        }
        .winning-team-highlight {
            background-color: #86efac;
            font-weight: bold;
        }
        .daily-flow-table td {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        .daily-flow-table th {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
    </style>
</head>
<body class="p-4 bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="container bg-white rounded-xl shadow-lg p-6 md:p-8 lg:p-10">
        <img id="trip-logo" src="https://raw.githubusercontent.com/coryhiggins1985/Bandon_Dunes/main/logo.png" alt="Trip Logo" />
        <h1 class="text-3xl md:text-4xl font-bold text-green-800 mb-8 text-left" id="main-trip-summary-title">Bandon Dunes Golf Trip Summary</h1>

        <div class="flex border-b border-gray-200 mb-6">
            <button id="tab-summary" class="tab-button active">Trip Summary</button>
            <button id="tab-caddy" class="tab-button">Caddy Summary</button>
            <button id="tab-caddy-by-tee-time" class="tab-button">Caddy Summary by Tee Time</button>
            <button id="tab-daily-flow" class="tab-button">Daily Flow</button>
            <button id="tab-scoring" class="tab-button">8/20 - Team Scoring</button>
        </div>

        <div id="content-summary" class="tab-content active">
            <div class="card mb-6">
                <div class="mb-4 player-select-section w-full md:w-1\/2">
                    <label for="player-select" class="block text-lg font-medium text-red-600 mb-2">Select Player:</label>
                    <select id="player-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
                        </select>
                </div>
            </div>

            <div class="flex flex-col md:flex-row gap-6 mb-6">
                <div class="card flex-1 md:w-1\/2">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Stableford Points System</h2>
                    <table class="table-auto" id="stableford-table">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Score Relative to Par</th>
                                <th class="px-4 py-2">Points</th>
                                <th class="px-4 py-2">Score Relative to Par</th>
                                <th class="px-4 py-2">Points</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border px-4 py-2">Double Eagle (Par 4 or 5)</td>
                                <td class="border px-4 py-2">20</td>
                                <td class="border px-4 py-2">Par</td>
                                <td class="border px-4 py-2">3</td>
                            </tr>
                            <tr>
                                <td class="border px-4 py-2">Hole-in-One</td>
                                <td class="border px-4 py-2">15</td>
                                <td class="border px-4 py-2">Bogey</td>
                                <td class="border px-4 py-2">2</td>
                            </tr>
                            <tr>
                                <td class="border px-4 py-2">Eagle</td>
                                <td class="border px-4 py-2">10</td>
                                <td class="border px-4 py-2">Double Bogey</td>
                                <td class="border px-4 py-2">1</td>
                            </tr>
                            <tr>
                                <td class="border px-4 py-2">Birdie</td>
                                <td class="border px-4 py-2">5</td>
                                <td class="border px-4 py-2">DNF/Triple +</td>
                                <td class="border px-4 py-2">0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="card flex-1 md:w-1\/2">
                    <h2 class="text-2xl font-semibold text-gray-800 mb-4">Notes</h2>
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Note</th>
                            </tr>
                        </thead>
                        <tbody id="notes-table-body">
                            </tbody>
                    </table>
                </div>
            </div>

            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Daily Group Gambling</h2>
                <table class="table-auto">
                    <thead>
                        <tr>
                            <th class="px-4 py-2">Item</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="border px-4 py-2">$50 / daily group bet for AM rounds only, afternoon rounds choose your own adventure.</td>
                        </tr>
                        <tr>
                            <td class="border px-4 py-2">There will be six (6), four (4) man teams. $240 payout per person on the winning team ($960 pot divided by 4).</td>
                        </tr>
                        <tr>
                            <td class="border px-4 py-2">Gimmies are okay but don't swipe a 5 foot putt and call it yourself, let the group decide.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Tee Time Pairings</h2>
                <div id="tee-time-pairings-container" class="overflow-x-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4" id="current-player-tee-times-title"></h3>
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Date</th>
                                <th class="px-4 py-2">Time</th>
                                <th class="px-4 py-2">Estimated Completion Time</th>
                                <th class="px-4 py-2">Course</th>
                                <th class="px-4 py-2">Caddie</th>
                                <th class="px-4 py-2">Playing Partners (Handicap)</th>
                            </tr>
                        </thead>
                        <tbody id="tee-time-pairings-body">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Daily Pairings</h2>
                <div id="daily-pairings-container" class="overflow-x-auto">
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Date</th>
                                <th class="px-4 py-2">Time</th>
                                <th class="px-4 py-2">Estimated Completion Time</th>
                                <th class="px-4 py-2">Course</th>
                                <th class="px-4 py-2">All Players (Handicap)</th>
                            </tr>
                        </thead>
                        <tbody id="daily-pairings-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="content-caddy" class="tab-content">
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Caddy Summary by Player and Round</h2>
                <div id="caddy-summary-container" class="overflow-x-auto">
                    <table class="table-auto">
                        <thead>
                            <tr id="caddy-summary-header-row">
                                <th class="px-4 py-2">Player</th>
                                </tr>
                        </thead>
                        <tbody id="caddy-summary-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="content-caddy-by-tee-time" class="tab-content">
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Caddy Summary by Tee Time</h2>
                <div id="caddy-tee-time-summary-container" class="overflow-x-auto">
                    <table class="table-auto">
                        <thead>
                            <tr>
                                <th class="px-4 py-2">Date</th>
                                <th class="px-4 py-2">Time</th>
                                <th class="px-4 py-2">Course</th>
                                <th class="px-4 py-2">Players & Caddies</th>
                                <th class="px-4 py-2">Caddy Summary</th>
                            </tr>
                        </thead>
                        <tbody id="caddy-tee-time-summary-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="content-daily-flow" class="tab-content">
            <div class="card mt-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Daily Flow</h2>
                <div id="daily-flow-container" class="overflow-x-auto">
                    <table class="table-auto w-full daily-flow-table">
                        <thead id="daily-flow-header"></thead>
                        <tbody id="daily-flow-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div id="content-scoring" class="tab-content">
            <div class="card">
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">Daily Scoring (8/20)</h2>
                <div class="mb-4">
                    <label for="team-select" class="block text-lg font-medium text-gray-700 mb-2">Select Team Format:</label>
                    <select id="team-select" class="mt-1 block w-full md:w-1/4 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
                        <option value="six">Six Teams</option>
                        <option value="four">Four Teams</option>
                    </select>
                </div>

                <div id="six-team-view">
                    </div>

                <div id="four-team-view" style="display: none;">
                    </div>
            </div>
        </div>

    </div>
    <script>
        // Raw CSV data for golf pairings - Corrected to match the latest official pairings file.
        const csvData = `Date,Time,Course,Player1,Player2,Player3,Player4,Player5,Notes,CompleteEstimate
2025-08-20,2:40 p.m.,Bandon Dunes,Cory Higgins,Kevin Newell,Mike Newell,Rob Small,,,2025-08-20 19:10:00
2025-08-20,2:50 p.m.,Bandon Dunes,Zach Deines,Johnathn Resetar,Ryan Hohn,Jacob Emert,,,2025-08-20 19:20:00
2025-08-20,3:00 p.m.,Bandon Dunes,Bryan Wolfe,Matt Akers,Paul Parker,Andrew Akers,,,2025-08-20 19:30:00
2025-08-20,3:10 p.m.,Bandon Dunes,Kevan Oyama,Bob Owlett,Nick Zangardi,James Adolfson,,,2025-08-20 19:40:00
2025-08-20,3:20 p.m.,Bandon Dunes,Vikas Bhasin,Daniel Passino,Charlie Hildebrand,Hisham Sayeedi,,,2025-08-20 19:50:00
2025-08-20,6:45 p.m.,Shorty's,Brandon Itaoka,Cory Micheel,AD Hoffman,Will Quarles,,,2025-08-20 20:45:00
2025-08-21,7:30 a.m.,Pacific Dunes,Vikas Bhasin,Charlie Hildebrand,Hisham Sayeedi,Daniel Passino,,,2025-08-21 12:00:00
2025-08-21,7:40 a.m.,Pacific Dunes,Cory Higgins,Matt Akers,Andrew Akers,James Adolfson,,,2025-08-21 12:10:00
2025-08-21,7:50 a.m.,Pacific Dunes,Bob Owlett,Kevin Newell,Mike Newell,Rob Small,,,2025-08-21 12:20:00
2025-08-21,8:00 a.m.,Pacific Dunes,Kevan Oyama,Zach Deines,Nick Zangardi,Johnathn Resetar,,,2025-08-21 12:30:00
2025-08-21,8:10 a.m.,Pacific Dunes,Brandon Itaoka,Ryan Hohn,Paul Parker,Jacob Emert,,,2025-08-21 12:40:00
2025-08-21,8:20 a.m.,Pacific Dunes,AD Hoffman,Bryan Wolfe,Will Quarles,Cory Micheel,,,2025-08-21 12:50:00
2025-08-21,1:10 p.m.,Bandon Dunes,Charlie Hildebrand,Hisham Sayeedi,Daniel Passino,Vikas Bhasin,,REPLAY,2025-08-21 17:40:00
2025-08-21,1:20 p.m.,Bandon Dunes,Kevan Oyama,Cory Higgins,Jacob Emert,Mike Newell,,REPLAY,2025-08-21 17:50:00
2025-08-21,1:30 p.m.,Bandon Dunes,Zach Deines,Paul Parker,Johnathn Resetar,James Adolfson,,REPLAY,2025-08-21 18:00:00
2025-08-21,1:40 p.m.,Bandon Dunes,Cory Micheel,Bob Owlett,Will Quarles,AD Hoffman,,REPLAY,2025-08-21 18:10:00
2025-08-21,1:50 p.m.,Bandon Dunes,Ryan Hohn,Nick Zangardi,Bryan Wolfe,,,REPLAY,2025-08-21 18:20:00
2025-08-21,2:15 p.m.,Bandon Preserve,Matt Akers,Andrew Akers,Kevin Newell,Rob Small,Brandon Itaoka,Bill to individuals,2025-08-21 16:15:00
2025-08-22,7:30 a.m.,Bandon Trails,AD Hoffman,Bryan Wolfe,Bob Owlett,Cory Micheel,,,2025-08-22 12:00:00
2025-08-22,7:40 a.m.,Bandon Trails,Cory Higgins,Brandon Itaoka,Ryan Hohn,Paul Parker,,,2025-08-22 12:10:00
2025-08-22,7:50 a.m.,Bandon Trails,Mike Newell,Nick Zangardi,Kevin Newell,Rob Small,,,2025-08-22 12:20:00
2025-08-22,8:00 a.m.,Bandon Trails,Zach Deines,Johnathn Resetar,James Adolfson,Jacob Emert,,,2025-08-22 12:30:00
2025-08-22,8:10 a.m.,Bandon Trails,Vikas Bhasin,Daniel Passino,Hisham Sayeedi,Charlie Hildebrand,,,2025-08-22 12:40:00
2025-08-22,8:20 a.m.,Bandon Trails,Kevan Oyama,Matt Akers,Andrew Akers,Will Quarles,,,2025-08-22 12:50:00
2025-08-22,1:10 p.m.,Pacific Dunes,Cory Higgins,Vikas Bhasin,Cory Micheel,Mike Newell,,REPLAY,2025-08-22 17:40:00
2025-08-22,1:20 p.m.,Pacific Dunes,Bob Owlett,Nick Zangardi,Jacob Emert,Zach Deines,,REPLAY,2025-08-22 17:50:00
2025-08-22,1:30 p.m.,Pacific Dunes,James Adolfson,AD Hoffman,Bryan Wolfe,Will Quarles,,REPLAY,2025-08-22 18:00:00
2025-08-22,1:40 p.m.,Pacific Dunes,Kevan Oyama,Johnathn Resetar,,,REPLAY,2025-08-22 18:10:00
2025-08-22,2:15 p.m.,Shorty's,Brandon Itaoka,Ryan Hohn,Paul Parker,Charlie Hildebrand,Hisham Sayeedi,Bill to individuals,2025-08-22 16:15:00
2025-08-22,6:30 p.m.,Shorty's,Daniel Passino,Andrew Akers,Kevin Newell,Rob Small,Matt Akers,Bill to individuals,2025-08-22 20:30:00
2025-08-23,7:30 a.m.,Old Macdonald,Kevan Oyama,Mike Newell,Bob Owlett,Nick Zangardi,,,2025-08-23 12:00:00
2025-08-23,7:40 a.m.,Old Macdonald,Cory Higgins,Brandon Itaoka,Jacob Emert,Zach Deines,,,2025-08-23 12:10:00
2025-08-23,7:50 a.m.,Old Macdonald,Rob Small,Matt Akers,Andrew Akers,Kevin Newell,,,2025-08-23 12:20:00
2025-08-23,8:00 a.m.,Old Macdonald,Johnathn Resetar,Ryan Hohn,Paul Parker,James Adolfson,,,2025-08-23 12:30:00
2025-08-23,8:10 a.m.,Old Macdonald,Vikas Bhasin,Daniel Passino,Hisham Sayeedi,Charlie Hildebrand,,,2025-08-23 12:40:00
2025-08-23,8:20 a.m.,Old Macdonald,AD Hoffman,Bryan Wolfe,Will Quarles,Cory Micheel,,,2025-08-23 12:50:00
2025-08-23,1:10 p.m.,Sheep Ranch,Cory Higgins,Matt Akers,Andrew Akers,Jacob Emert,,REPLAY,2025-08-23 17:40:00
2025-08-23,1:20 p.m.,Sheep Ranch,Mike Newell,Kevan Oyama,Nick Zangardi,Bryan Wolfe,,REPLAY,2025-08-23 17:50:00
2025-08-23,2:15 p.m.,Bandon Preserve,Kevin Newell,Rob Small,Vikas Bhasin,Charlie Hildebrand,,Bill to individuals,2025-08-23 16:15:00
2025-08-24,7:00 a.m.,Sheep Ranch,Kevan Oyama,AD Hoffman,Kevin Newell,Rob Small,,,2025-08-24 11:30:00
2025-08-24,7:10 a.m.,Sheep Ranch,Vikas Bhasin,Daniel Passino,Hisham Sayeedi,Charlie Hildebrand,,,2025-08-24 11:40:00
2025-08-24,7:20 a.m.,Sheep Ranch,Cory Higgins,Bob Owlett,Mike Newell,Cory Micheel,,,2025-08-24 11:50:00
2025-08-24,7:30 a.m.,Sheep Ranch,Zach Deines,Johnathn Resetar,Jacob Emert,Brandon Itaoka,,,2025-08-24 12:00:00
2025-08-24,7:40 a.m.,Sheep Ranch,James Adolfson,Ryan Hohn,Nick Zangardi,Paul Parker,,,2025-08-24 12:10:00`;
        
        // Caddy data
        const completeCaddyData = {
            "AD Hoffman": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Non-Carry Strategy Caddy" }
            },
            "Andrew Akers": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Not Playing" }
            },
            "Bob Owlett": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "No Caddy" }
            },
            "Brandon Itaoka": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "No Caddy" }
            },
            "Bryan Wolfe": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Not Playing" }
            },
            "Charlie Hildebrand": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Carry Caddy" }
            },
            "Cory Higgins": {
                "2025-08-20": { "PM": "Carry Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Carry Caddy", "PM": "Carry Caddy" },
                "2025-08-23": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Carry Caddy" }
            },
            "Cory Micheel": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Non-Carry Strategy Caddy", "PM": "Carry Caddy" },
                "2025-08-23": { "AM": "Non-Carry Strategy Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "No Caddy" }
            },
            "Daniel Passino": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "No Caddy", "PM": "Carry Caddy" },
                "2025-08-22": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Carry Caddy" }
            },
            "Hisham Sayeedi": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Carry Caddy" }
            },
            "Jacob Emert": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Not Playing", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Carry Caddy" }
            },
            "James Adolfson": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Not Playing", "PM": "No Caddy" },
                "2025-08-23": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "No Caddy" }
            },
            "Johnathn Resetar": {
                "2025-08-20": { "PM": "Carry Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Not Playing", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "No Caddy" }
            },
            "Kevan Oyama": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "Carry Caddy" },
                "2025-08-22": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Carry Caddy" }
            },
            "Kevin Newell": {
                "2025-08-20": { "PM": "Carry Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Carry Caddy" }
            },
            "Matt Akers": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "No Caddy" }
            },
            "Mike Newell": {
                "2025-08-20": { "PM": "Carry Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "Carry Caddy" },
                "2025-08-22": { "AM": "Carry Caddy", "PM": "Carry Caddy" },
                "2025-08-23": { "AM": "Carry Caddy", "PM": "Carry Caddy" },
                "2025-08-24": { "AM": "Carry Caddy" }
            },
            "Nick Zangardi": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "No Caddy" }
            },
            "Paul Parker": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Non-Carry Strategy Caddy" }
            },
            "Rob Small": {
                "2025-08-20": { "PM": "Carry Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Carry Caddy" }
            },
            "Ryan Hohn": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "No Caddy" }
            },
            "Vikas Bhasin": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "Carry Caddy" },
                "2025-08-22": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Carry Caddy" }
            },
            "Will Quarles": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "Carry Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-23": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "Not Playing" }
            },
            "Zach Deines": {
                "2025-08-20": { "PM": "No Caddy" },
                "2025-08-21": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-22": { "AM": "Not Playing", "PM": "No Caddy" },
                "2025-08-23": { "AM": "No Caddy", "PM": "No Caddy" },
                "2025-08-24": { "AM": "No Caddy" }
            }
        };

        // Rooming data - Rebuilt from the definitive rooming list image provided by the user.
        const roomingData = {
            "Matt Akers": { accommodation: "Golf Double", roommates: ["Andrew Akers"] },
            "Andrew Akers": { accommodation: "Golf Double", roommates: ["Matt Akers"] },
            "Bob Owlett": { accommodation: "Golf Double", roommates: ["Kevan Oyama"] },
            "Kevan Oyama": { accommodation: "Golf Double", roommates: ["Bob Owlett"] },
            "Brandon Itaoka": { accommodation: "Golf Double", roommates: ["Cory Micheel"] },
            "Cory Micheel": { accommodation: "Golf Double", roommates: ["Brandon Itaoka"] },
            "Charlie Hildebrand": { accommodation: "Golf Double", roommates: ["Hisham Sayeedi"] },
            "Hisham Sayeedi": { accommodation: "Golf Double", roommates: ["Charlie Hildebrand"] },
            "James Adolfson": { accommodation: "Golf Double", roommates: ["Will Quarles"] },
            "Will Quarles": { accommodation: "Golf Double", roommates: ["James Adolfson"] },
            "Johnathn Resetar": { accommodation: "Golf Double", roommates: ["Paul Parker"] },
            "Paul Parker": { accommodation: "Golf Double", roommates: ["Johnathn Resetar"] },
            "Kevin Newell": { accommodation: "Golf Double", roommates: ["Mike Newell"] },
            "Mike Newell": { accommodation: "Golf Double", roommates: ["Kevin Newell"] },
            "Nick Zangardi": { accommodation: "Golf Double", roommates: ["Rob Small"] },
            "Rob Small": { accommodation: "Golf Double", roommates: ["Nick Zangardi"] },
            "Zach Deines": { accommodation: "Golf Double", roommates: ["Jacob Emert"] },
            "Jacob Emert": { accommodation: "Golf Double", roommates: ["Zach Deines"] },
            "Bryan Wolfe": { accommodation: "Golf Double", roommates: ["AD Hoffman"] },
            "AD Hoffman": { accommodation: "Golf Double", roommates: ["Bryan Wolfe"] },
            "Cory Higgins": { accommodation: "Grove Cottage", roommates: ["Ryan Hohn", "Daniel Passino", "Vikas Bhasin"] },
            "Ryan Hohn": { accommodation: "Grove Cottage", roommates: ["Cory Higgins", "Daniel Passino", "Vikas Bhasin"] },
            "Daniel Passino": { accommodation: "Grove Cottage", roommates: ["Cory Higgins", "Ryan Hohn", "Vikas Bhasin"] },
            "Vikas Bhasin": { accommodation: "Grove Cottage", roommates: ["Cory Higgins", "Ryan Hohn", "Daniel Passino"] }
        };

        // Handicap data - UPDATED with the final definitive list.
        const handicaps = {
            "Mike Newell": 0.0,
            "Andrew Akers": 2.0,
            "Cory Higgins": 2.8,
            "James Adolfson": 3.0,
            "Ryan Hohn": 4.3,
            "Kevan Oyama": 4.0,
            "Bob Owlett": 4.9,
            "Jacob Emert": 5.8,
            "Brandon Itaoka": 6.8,
            "Zach Deines": 7.9,
            "Rob Small": 9.1,
            "Kevin Newell": 9.8,
            "Nick Zangardi": 10.0,
            "Vikas Bhasin": 10.5,
            "Hisham Sayeedi": 11.0,
            "Daniel Passino": 11.0,
            "Cory Micheel": 11.0,
            "AD Hoffman": 11.4,
            "Bryan Wolfe": 11.9,
            "Johnathn Resetar": 12.7,
            "Paul Parker": 13.0,
            "Charlie Hildebrand": 15.0,
            "Will Quarles": 16.8,
            "Matt Akers": 16.2
        };

        // Meal data
        const mealsData = {
            "Kevin Newell": { "Breakfast Buffet": 1, "Lunch Box": 1 },
            "Ryan Hohn": { "Breakfast Buffet": 1, "Lunch Box": 1 },
            "Johnathn Resetar": { "Breakfast Buffet": 1, "Lunch Box": 1 },
            "Charlie Hildebrand": { "Breakfast Buffet": 1, "Lunch Box": 1 },
            "Rob Small": { "Breakfast Buffet": 1, "Lunch Box": 1 },
            "Mike Newell": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Cory Higgins": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Zach Deines": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Vikas Bhasin": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Jacob Emert": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Brandon Itaoka": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Nick Zangardi": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Andrew Akers": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Hisham Sayeedi": { "Breakfast Buffet": 0, "Lunch Box": 1 },
            "Daniel Passino": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Matt Akers": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Bryan Wolfe": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Bob Owlett": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Kevan Oyama": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Cory Micheel": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "AD Hoffman": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Paul Parker": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "James Adolfson": { "Breakfast Buffet": 0, "Lunch Box": 0 },
            "Will Quarles": { "Breakfast Buffet": 0, "Lunch Box": 0 }
        };

        // Team data for scoring tab
        const sixTeamData = {
            "Team 1": ["Mike Newell", "Rob Small", "Vikas Bhasin", "Matt Akers"],
            "Team 2": ["Andrew Akers", "Nick Zangardi", "Daniel Passino", "Will Quarles"],
            "Team 3": ["Cory Higgins", "Kevin Newell", "Hisham Sayeedi", "Charlie Hildebrand"],
            "Team 4": ["James Adolfson", "Zach Deines", "Cory Micheel", "Paul Parker"],
            "Team 5": ["Ryan Hohn", "Jacob Emert", "AD Hoffman", "Johnathn Resetar"],
            "Team 6": ["Kevan Oyama", "Bob Owlett", "Brandon Itaoka", "Bryan Wolfe"]
        };

        const fourTeamData = {
            "Team 1": ["Mike Newell", "Ryan Hohn", "Kevin Newell", "AD Hoffman", "Paul Parker", "Will Quarles"],
            "Team 2": ["Andrew Akers", "Kevan Oyama", "Nick Zangardi", "Bryan Wolfe", "Charlie Hildebrand", "Matt Akers"],
            "Team 3": ["Cory Higgins", "Jacob Emert", "Daniel Passino", "Hisham Sayeedi", "Cory Micheel", "Johnathn Resetar"],
            "Team 4": ["James Adolfson", "Bob Owlett", "Brandon Itaoka", "Zach Deines", "Rob Small", "Vikas Bhasin"]
        };
        
        const scores820 = {};
        Object.keys(handicaps).forEach(player => {
            scores820[player] = 25; // Default score
        });
        scores820["Cory Higgins"] = 50; // Special case

        // All JavaScript functions follow...
        function parseCSV(csv) {
            const lines = csv.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) return [];

            const data = [];
            const headers = lines[0].split(',').map(h => h.trim());
            const dateIndex = headers.indexOf('Date');
            const timeIndex = headers.indexOf('Time');
            const courseIndex = headers.indexOf('Course');
            const playerIndices = [
                headers.indexOf('Player1'),
                headers.indexOf('Player2'),
                headers.indexOf('Player3'),
                headers.indexOf('Player4'),
                headers.indexOf('Player5')
            ].filter(i => i !== -1);
            const notesIndex = headers.indexOf('Notes');
            const completeEstimateIndex = headers.indexOf('CompleteEstimate');

            for (let i = 1; i < lines.length; i++) {
                const currentLine = lines[i].split(',');
                const row = {};
                row['Date'] = currentLine[dateIndex] ? currentLine[dateIndex].trim() : '';
                row['Time'] = currentLine[timeIndex] ? currentLine[timeIndex].trim() : '';
                row['Course'] = currentLine[courseIndex] ? currentLine[courseIndex].trim() : '';
                row['Notes'] = notesIndex > -1 && currentLine[notesIndex] ? currentLine[notesIndex].trim() : '';
                row['CompleteEstimate'] = completeEstimateIndex > -1 && currentLine[completeEstimateIndex] ? currentLine[completeEstimateIndex].trim() : '';
                
                let players = [];
                playerIndices.forEach((pIndex) => {
                    if (pIndex < currentLine.length) {
                        const playerName = currentLine[pIndex] ? currentLine[pIndex].trim() : '';
                        if (playerName) {
                            players.push(playerName);
                        }
                    }
                });
                row['Players'] = players;

                if (row['Date'] && row['Time'] && row['Course'] && players.length > 0) {
                    data.push(row);
                }
            }
            return data;
        }

        function populatePlayerSelect(players) {
            const playerSelect = document.getElementById('player-select');
            if (playerSelect) {
                playerSelect.innerHTML = '';
                const sortedPlayers = [...players].sort();
                sortedPlayers.forEach(player => {
                    const option = document.createElement('option');
                    option.value = player;
                    option.textContent = player;
                    playerSelect.appendChild(option);
                });
            }
        }

        function populateNotes(playerName) {
            const notesBody = document.getElementById('notes-table-body');
            notesBody.innerHTML = '';

            const staticNotes = ["Welcome dinner at Trail's End 8:30 p.m."];
            staticNotes.forEach(note => {
                const tr = document.createElement('tr');
                const td = document.createElement('td');
                td.className = 'border px-4 py-2';
                td.textContent = note;
                tr.appendChild(td);
                notesBody.appendChild(tr);
            });

            const playerMeals = mealsData[playerName];
            if (playerMeals) {
                const breakfastStatus = playerMeals["Breakfast Buffet"] === 1 ? "Yes" : "No";
                const lunchStatus = playerMeals["Lunch Box"] === 1 ? "Yes" : "No";

                let trBreakfast = document.createElement('tr');
                let tdBreakfast = document.createElement('td');
                tdBreakfast.className = 'border px-4 py-2';
                tdBreakfast.textContent = `Breakfast: ${breakfastStatus}`;
                trBreakfast.appendChild(tdBreakfast);
                notesBody.appendChild(trBreakfast);

                let trLunch = document.createElement('tr');
                let tdLunch = document.createElement('td');
                tdLunch.className = 'border px-4 py-2';
                tdLunch.textContent = `Lunch: ${lunchStatus}`;
                trLunch.appendChild(tdLunch);
                notesBody.appendChild(trLunch);
            }

            const playerRoomingInfo = roomingData[playerName];
            if (playerRoomingInfo) {
                let trAccommodations = document.createElement('tr');
                let tdAccommodations = document.createElement('td');
                tdAccommodations.className = 'border px-4 py-2';
                tdAccommodations.textContent = `Accommodations: ${playerRoomingInfo.accommodation}`;
                trAccommodations.appendChild(tdAccommodations);
                notesBody.appendChild(trAccommodations);

                let trRoommate = document.createElement('tr');
                let tdRoommate = document.createElement('td');
                tdRoommate.className = 'border px-4 py-2';
                let roommateText = 'None';
                if (playerRoomingInfo.roommates && playerRoomingInfo.roommates.length > 0) {
                    roommateText = playerRoomingInfo.roommates.join(', ');
                }
                const roommateLabel = (playerRoomingInfo.roommates && playerRoomingInfo.roommates.length > 1) ? 'Roommates' : 'Roommate';
                tdRoommate.textContent = `${roommateLabel}: ${roommateText}`;
                trRoommate.appendChild(tdRoommate);
                notesBody.appendChild(trRoommate);
            }
        }

        function populateTeeTimesForPlayer(playerName) {
            const pairingsBody = document.getElementById('tee-time-pairings-body');
            const currentPlayerTitle = document.getElementById('current-player-tee-times-title');
            const mainTripSummaryTitle = document.getElementById('main-trip-summary-title');
            const stablefordTableBody = document.querySelector('#stableford-table tbody');
            const parsedData = parseCSV(csvData);

            mainTripSummaryTitle.textContent = `${playerName} - Bandon Dunes Golf Trip Summary`;
            currentPlayerTitle.textContent = `${playerName}'s Tee Time Pairings`;
            pairingsBody.innerHTML = '';

            const existingHandicapRow = stablefordTableBody.querySelector('.player-handicap-row');
            if (existingHandicapRow) existingHandicapRow.remove();
            const existingSpacingRow = stablefordTableBody.querySelector('.spacing-row');
            if (existingSpacingRow) existingSpacingRow.remove();

            const spacingTr = document.createElement('tr');
            spacingTr.className = 'spacing-row';
            spacingTr.innerHTML = '<td colspan="4"></td>';
            stablefordTableBody.appendChild(spacingTr);

            const playerHandicap = handicaps[playerName];
            if (playerHandicap !== undefined) {
                const tr = document.createElement('tr');
                tr.className = 'player-handicap-row';
                tr.innerHTML = `<td class="border px-4 py-2 font-semibold">${playerName}'s Handicap</td><td class="border px-4 py-2 bg-white">${playerHandicap.toFixed(1)}</td><td class="border px-4 py-2 bg-white" colspan="2"></td>`;
                stablefordTableBody.appendChild(tr);
            }

            let playerTeeTimes = parsedData.filter(row => row.Players.includes(playerName));

            playerTeeTimes.sort((a, b) => {
                const dateA = new Date(`${a['Date']} ${a['Time'].replace(/\./g, '')}`);
                const dateB = new Date(`${b['Date']} ${b['Time'].replace(/\./g, '')}`);
                return dateA - dateB;
            });

            playerTeeTimes.forEach(row => {
                const tr = document.createElement('tr');
                const dateObj = new Date(row['Date'].replace(/-/g, '/'));
                const dateTd = document.createElement('td');
                dateTd.className = 'px-4 py-2';
                dateTd.textContent = dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'numeric', day: 'numeric' }).replace(',', ' -');
                tr.appendChild(dateTd);

                const timeTd = document.createElement('td');
                timeTd.className = 'px-4 py-2';
                timeTd.textContent = row['Time'];
                tr.appendChild(timeTd);

                const completeTimeTd = document.createElement('td');
                completeTimeTd.className = 'px-4 py-2';
                const fullDateTime = row['CompleteEstimate'];
                if (fullDateTime && fullDateTime.includes(' ')) {
                    const timeString = new Date(fullDateTime).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
                    completeTimeTd.textContent = timeString;
                } else {
                    completeTimeTd.textContent = 'N/A';
                }
                tr.appendChild(completeTimeTd);

                const courseTd = document.createElement('td');
                courseTd.className = 'px-4 py-2';
                courseTd.textContent = row['Course'];
                tr.appendChild(courseTd);

                let teeTimeAmPm = row['Time'].toLowerCase().includes('p.m.') ? 'PM' : 'AM';
                let caddyTypeForRound = completeCaddyData[playerName]?.[row['Date']]?.[teeTimeAmPm] || 'N/A';
                const caddieTd = document.createElement('td');
                caddieTd.className = 'px-4 py-2';
                caddieTd.textContent = caddyTypeForRound;
                tr.appendChild(caddieTd);

                const partnersTd = document.createElement('td');
                partnersTd.className = 'px-4 py-2';
                const partners = row.Players
                    .filter(p => p && p !== playerName && p !== 'TBD')
                    .map(p => `${p} (${handicaps[p] !== undefined ? handicaps[p].toFixed(1) : 'N/A'})`)
                    .join(', ');
                partnersTd.textContent = partners;
                tr.appendChild(partnersTd);
                pairingsBody.appendChild(tr);
            });
        }

        function populateDailyPairings() {
            const dailyPairingsBody = document.getElementById('daily-pairings-body');
            dailyPairingsBody.innerHTML = '';
            const parsedData = parseCSV(csvData);

            const pairingsByDate = {};
            parsedData.forEach(row => {
                if (!pairingsByDate[row.Date]) pairingsByDate[row.Date] = [];
                pairingsByDate[row.Date].push(row);
            });

            Object.keys(pairingsByDate).sort().forEach(date => {
                const dailyPairings = pairingsByDate[date].sort((a,b) => new Date(`${a.Date} ${a.Time.replace(/\./g, '')}`) - new Date(`${b.Date} ${b.Time.replace(/\./g, '')}`));
                dailyPairings.forEach((row, index) => {
                    const tr = document.createElement('tr');
                    if (index === dailyPairings.length - 1 && date !== '2025-08-24') {
                        tr.className = 'last-tee-time-of-day';
                    }
                    
                    const dateObj = new Date(row.Date.replace(/-/g, '/'));
                    const fullDateTime = row['CompleteEstimate'];
                    let completeTimeText = 'N/A';
                    if (fullDateTime && fullDateTime.includes(' ')) {
                        completeTimeText = new Date(fullDateTime).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
                    }

                    tr.innerHTML = `
                        <td class="px-4 py-2">${dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'numeric', day: 'numeric' }).replace(',', ' -')}</td>
                        <td class="px-4 py-2">${row.Time}</td>
                        <td class="px-4 py-2">${completeTimeText}</td>
                        <td class="px-4 py-2">${row.Course}</td>
                        <td class="px-4 py-2">${row.Players.filter(p => p && p !== 'TBD').map(p => `${p} (${handicaps[p] !== undefined ? handicaps[p].toFixed(1) : 'N/A'})`).join('<br>')}</td>
                    `;
                    dailyPairingsBody.appendChild(tr);
                });
            });
        }

        function populateCaddySummary() {
            const caddySummaryBody = document.getElementById('caddy-summary-body');
            const caddySummaryHeaderRow = document.getElementById('caddy-summary-header-row');
            caddySummaryBody.innerHTML = '';
            caddySummaryHeaderRow.innerHTML = '<th class="px-4 py-2">Player</th>';

            const players = Object.keys(handicaps).sort();
            
            const dateRounds = [
                { date: '2025-08-20', round: 'PM', label: 'Wed 8/20 (PM)' },
                { date: '2025-08-21', round: 'AM', label: 'Thu 8/21 (AM)' },
                { date: '2025-08-21', round: 'PM', label: 'Thu 8/21 (PM)' },
                { date: '2025-08-22', round: 'AM', label: 'Fri 8/22 (AM)' },
                { date: '2025-08-22', round: 'PM', label: 'Fri 8/22 (PM)' },
                { date: '2025-08-23', round: 'AM', label: 'Sat 8/23 (AM)' },
                { date: '2025-08-23', round: 'PM', label: 'Sat 8/23 (PM)' },
                { date: '2025-08-24', round: 'AM', label: 'Sun 8/24 (AM)' }
            ];

            dateRounds.forEach(dateRound => {
                const th = document.createElement('th');
                th.className = 'px-4 py-2';
                th.textContent = dateRound.label;
                caddySummaryHeaderRow.appendChild(th);
            });

            players.forEach(player => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td class="px-4 py-2 font-semibold">${player}</td>`;
                
                dateRounds.forEach(dateRound => {
                    const caddyType = completeCaddyData[player]?.[dateRound.date]?.[dateRound.round] || 'N/A';
                    const caddyTd = document.createElement('td');
                    caddyTd.className = 'px-4 py-2';
                    caddyTd.textContent = caddyType;
                    tr.appendChild(caddyTd);
                });
                caddySummaryBody.appendChild(tr);
            });
        }

        function populateCaddySummaryByTeeTime() {
            const teeTimeSummaryBody = document.getElementById('caddy-tee-time-summary-body');
            if (!teeTimeSummaryBody) return;
            teeTimeSummaryBody.innerHTML = '';
            const parsedData = parseCSV(csvData);

            const teeTimesByDate = {};
            parsedData.forEach(row => {
                if (!teeTimesByDate[row.Date]) teeTimesByDate[row.Date] = [];
                teeTimesByDate[row.Date].push(row);
            });

            Object.keys(teeTimesByDate).sort().forEach(date => {
                const dailyTeeTimes = teeTimesByDate[date].sort((a,b) => new Date(`${a.Date} ${a.Time.replace(/\./g, '')}`) - new Date(`${b.Date} ${b.Time.replace(/\./g, '')}`));
                dailyTeeTimes.forEach((row, index) => {
                    const tr = document.createElement('tr');
                    const dateObj = new Date(row.Date.replace(/-/g, '/'));
                    let teeTimeAmPm = row['Time'].toLowerCase().includes('p.m.') ? 'PM' : 'AM';

                    const players = row.Players;
                    const playersWithCaddies = players.filter(p => p && p !== 'TBD').map(p => {
                        let caddyChoice = 'No Caddy';
                        if (row.Course !== "Shorty's" && row.Course !== "Bandon Preserve") {
                            caddyChoice = completeCaddyData[p]?.[date]?.[teeTimeAmPm] || 'No Caddy';
                        }
                        return `${p} - ${caddyChoice}`;
                    });

                    const caddyCounts = players.reduce((counts, player) => {
                        if (player && player !== 'TBD') {
                            let caddyChoice = 'No Caddy';
                            if (row.Course !== "Shorty's" && row.Course !== "Bandon Preserve") {
                                caddyChoice = completeCaddyData[player]?.[date]?.[teeTimeAmPm] || 'No Caddy';
                            }
                            if (caddyChoice !== 'No Caddy' && caddyChoice !== 'Not Playing') {
                                counts[caddyChoice] = (counts[caddyChoice] || 0) + 1;
                            }
                        }
                        return counts;
                    }, {});

                    const summaryString = Object.keys(caddyCounts).map(type => `${type}: ${caddyCounts[type]}`).join(', ') || 'No Caddies';
                    
                    tr.innerHTML = `
                        <td class="px-4 py-2">${dateObj.toLocaleDateString('en-US', { weekday: 'short', month: 'numeric', day: 'numeric' }).replace(',', ' -')}</td>
                        <td class="px-4 py-2">${row.Time}</td>
                        <td class="px-4 py-2">${row.Course}</td>
                        <td class="px-4 py-2">${playersWithCaddies.join('<br>')}</td>
                        <td class="px-4 py-2">${summaryString}</td>
                    `;
                    teeTimeSummaryBody.appendChild(tr);

                    if (index === dailyTeeTimes.length - 1 && Object.keys(teeTimesByDate).sort().pop() !== date) {
                        const separatorTr = document.createElement('tr');
                        separatorTr.className = 'caddy-summary-separator';
                        separatorTr.innerHTML = '<td colspan="5"></td>';
                        teeTimeSummaryBody.appendChild(separatorTr);
                    }
                });
            });
        }

        function populateDailyFlow(playerName) {
            const header = document.getElementById('daily-flow-header');
            const body = document.getElementById('daily-flow-body');
            const dailyFlowTitle = document.querySelector('#content-daily-flow .card h2');
            
            header.innerHTML = '';
            body.innerHTML = '';
            
            dailyFlowTitle.textContent = `Daily Flow - ${playerName}`;

            const dates = [...new Set(parseCSV(csvData).map(row => row.Date))].sort();
            let headerRow = '<tr><th class="px-2 py-1">Time</th>';
            dates.forEach(date => {
                const d = new Date(date.replace(/-/g, '/'));
                headerRow += `<th class="px-2 py-1">${d.toLocaleDateString('en-US', { weekday: 'short', month: 'numeric', day: 'numeric' })}</th>`;
            });
            headerRow += '</tr>';
            header.innerHTML = headerRow;

            const playerTeeTimes = parseCSV(csvData).filter(row => row.Players.includes(playerName));

            for (let hour = 7; hour <= 20; hour++) {
                for (let minute = 0; minute < 60; minute += 15) {
                    const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    let rowHtml = `<tr><td class="px-2 py-1 font-mono text-xs">${time}</td>`;

                    dates.forEach(date => {
                        let cellContent = '';
                        let cellClass = 'bg-gray-100';
                        const now = new Date(`${date} ${time}`);

                        if (date === '2025-08-20' && time === '20:30') {
                            cellContent = 'Trails End Grill - Group Dinner';
                            cellClass = 'bg-purple-200';
                        } else {
                            const dailyTeeTimes = playerTeeTimes.filter(tt => tt.Date === date).sort((a, b) =>
                                 new Date(`${a.Date} ${a.Time.replace(/\./g, '')}`) - new Date(`${b.Date} ${b.Time.replace(/\./g, '')}`)
                            );

                            let foundActivity = false;
                            
                            for(let i = 0; i < dailyTeeTimes.length; i++) {
                                const tt = dailyTeeTimes[i];
                                const startTime = new Date(`${tt.Date} ${tt.Time.replace(/\./g, '')}`);
                                const endTime = tt['CompleteEstimate'] ? new Date(tt['CompleteEstimate']) : new Date(startTime.getTime() + 4.5 * 60 * 60 * 1000);
                                                                
                                if (now >= startTime && now < endTime) {
                                    if(Math.abs(now - startTime) < 15 * 60 * 1000) {
                                        cellContent = `${tt.Time} - ${tt.Course}`;
                                    } else {
                                        cellContent = tt.Course;
                                    }
                                    cellClass = 'bg-blue-200';
                                    foundActivity = true;
                                    break;
                                }

                                if (i + 1 < dailyTeeTimes.length) {
                                    const nextTeeTime = new Date(`${dailyTeeTimes[i+1].Date} ${dailyTeeTimes[i+1].Time.replace(/\./g, '')}`);
                                    if (now >= endTime && now < nextTeeTime) {
                                        cellClass = 'bg-green-300';
                                        cellContent = 'Free Time';
                                        foundActivity = true;
                                        break;
                                    }
                                }
                            }
                            if (!foundActivity) {
                                cellContent = '';
                                cellClass = 'bg-gray-100';
                            }
                        }
                        rowHtml += `<td class="px-2 py-1 text-xs ${cellClass}">${cellContent}</td>`;
                    });
                    rowHtml += '</tr>';
                    body.innerHTML += rowHtml;
                }
            }
        }
        
        function populateScoringTable(teamData, scores, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = ''; // Clear previous content

            for (const teamName in teamData) {
                const players = teamData[teamName];
                
                let teamTotal = 0;
                players.forEach(player => {
                    teamTotal += scores[player] || 0;
                });

                let tableHtml = `
                    <div class="mb-6">
                        <table class="table-auto w-full">
                            <thead>
                                <tr>
                                    <th class="px-4 py-2 team-header" colspan="4">${teamName}</th>
                                </tr>
                                <tr>
                                    <th class="px-4 py-2">Player</th>
                                    <th class="px-4 py-2">Handicap</th>
                                    <th class="px-4 py-2">Score</th>
                                    <th class="px-4 py-2">Team Total</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                players.forEach((player, index) => {
                    const handicap = handicaps[player] ? handicaps[player].toFixed(1) : 'N/A';
                    const score = scores[player] || 0;
                    tableHtml += `
                        <tr>
                            <td class="border px-4 py-2">${player}</td>
                            <td class="border px-4 py-2">${handicap}</td>
                            <td class="border px-4 py-2">${score}</td>
                    `;
                    if (index === 0) {
                        tableHtml += `<td class="border px-4 py-2 font-bold" rowspan="${players.length}">${teamTotal}</td>`;
                    }
                    tableHtml += `</tr>`;
                });

                tableHtml += `
                            </tbody>
                        </table>
                    </div>
                `;
                container.innerHTML += tableHtml;
            }
        }

        function initialize() {
            const allPlayers = Object.keys(handicaps);
            populatePlayerSelect(allPlayers);
            
            const initialPlayer = allPlayers.sort()[0];
            document.getElementById('player-select').value = initialPlayer;
            
            populateTeeTimesForPlayer(initialPlayer);
            populateNotes(initialPlayer);
            populateDailyPairings();
            populateCaddySummary();
            populateCaddySummaryByTeeTime();
            populateDailyFlow(initialPlayer);
            populateScoringTable(sixTeamData, scores820, 'six-team-view');
            populateScoringTable(fourTeamData, scores820, 'four-team-view');

            document.getElementById('player-select').addEventListener('change', (event) => {
                const selectedPlayer = event.target.value;
                populateTeeTimesForPlayer(selectedPlayer);
                populateNotes(selectedPlayer);
                populateDailyFlow(selectedPlayer);
            });

            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    button.classList.add('active');
                    document.getElementById(button.id.replace('tab-', 'content-')).classList.add('active');
                });
            });

            document.getElementById('team-select').addEventListener('change', function() {
                if (this.value === 'six') {
                    document.getElementById('six-team-view').style.display = 'block';
                    document.getElementById('four-team-view').style.display = 'none';
                } else {
                    document.getElementById('six-team-view').style.display = 'none';
                    document.getElementById('four-team-view').style.display = 'block';
                }
            });
        }

        window.onload = initialize;
    </script>
</body>
</html>
